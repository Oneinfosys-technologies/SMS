import{f as ae,h as pe,i as ne,G as re,m as K,n as fe,r as $,o as l,q as U,w as s,d as f,e as o,u as e,H as ue,b as y,j as le,l as te,s as b,t as d,a as k,F as S,y as Z,K as be,Z as ge,v as Q,E as oe,B as he,C as se,x as ce,c as de,J as ve,ab as ke,L as $e}from"./app-DCfJDSeM.js";import{_ as _e}from"./OnlinePaymentForm-C7xaEMRA.js";import"./Billdesk-rvYHEUh7.js";const De={class:"mt-6 grid grid-cols-3 gap-4"},Ve={class:"col-span-3 sm:col-span-1"},Fe={class:"col-span-3 sm:col-span-1"},Ue={class:"col-span-3 sm:col-span-1"},Ce={class:"col-span-3 sm:col-span-1"},we={class:"col-span-3"},Pe={name:"StudentFeeEditPayment"},Be=Object.assign(Pe,{props:{transaction:{type:Object,default(){return{}}},preRequisites:{type:Object,default(){return{}}}},emits:["close","refresh"],setup(m,{emit:X}){const z=ae();pe(),ne();const J=X,I=m,V={date:"",codeNumber:"",ledger:"",paymentMethod:"",instrumentNumber:"",instrumentDate:"",clearingDate:"",bankDetail:"",referenceNumber:"",remarks:""},n="student/payment/",P=re(n),g=K({selectedPaymentMethod:{}}),c=K({...V}),i=w=>{c.paymentMethod=w?w.uuid:{},g.selectedPaymentMethod=w||{}},N=()=>{g.selectedPaymentMethod={},J("close"),J("refresh")};return fe(()=>{var A,M,D;let w=I.transaction,u=w.payments[0];V.codeNumber=w.codeNumber,V.date=(A=w.date)==null?void 0:A.value,V.ledger=u.ledgerUuid,V.paymentMethod=u.methodUuid,V.instrumentNumber=u.instrumentNumber||"",V.instrumentDate=((M=u.instrumentDate)==null?void 0:M.value)||"",V.clearingDate=((D=u.clearingDate)==null?void 0:D.value)||"",V.bankDetail=u.bankDetail||"",V.referenceNumber=u.referenceNumber||"",V.remarks=w.remarks,g.selectedPaymentMethod={uuid:u.methodUuid,name:u.methodName,hasBankDetail:u.hasBankDetail,hasInstrumentNumber:u.hasInstrumentNumber,hasInstrumentDate:u.hasInstrumentDate,hasClearingDate:u.hasClearingDate,hasReferenceNumber:u.hasReferenceNumber},Object.assign(c,V)}),(w,u)=>{const A=$("BaseInput"),M=$("DatePicker"),D=$("BaseSelect"),G=$("PaymentMethodInput"),C=$("BaseTextarea"),h=$("FormAction");return l(),U(h,{"no-card":"","no-data-fetch":"","is-modal":"",confirmation:"",uuid:e(z).params.uuid,"module-uuid":m.transaction.uuid,action:"updatePayment","init-url":n,"init-form":V,form:c,"keep-adding":!1,"cancel-action":!1,"submit-text":w.$trans("global.update",{attribute:w.$trans("student.payment.payment")}),onRedirectTo:N,onCancelled:N},{default:s(()=>[f("div",De,[f("div",Ve,[o(A,{modelValue:c.codeNumber,"onUpdate:modelValue":u[0]||(u[0]=t=>c.codeNumber=t),name:"codeNumber",label:w.$trans("finance.transaction.props.code_number"),error:e(P).codeNumber,"onUpdate:error":u[1]||(u[1]=t=>e(P).codeNumber=t)},null,8,["modelValue","label","error"])]),f("div",Fe,[o(M,{modelValue:c.date,"onUpdate:modelValue":u[2]||(u[2]=t=>c.date=t),name:"date","no-clear":"",label:w.$trans("student.fee.props.date"),error:e(P).date,"onUpdate:error":u[3]||(u[3]=t=>e(P).date=t)},null,8,["modelValue","label","error"])]),f("div",Ue,[o(D,{modelValue:c.ledger,"onUpdate:modelValue":u[4]||(u[4]=t=>c.ledger=t),name:"ledger",label:w.$trans("finance.ledger.ledger"),options:m.preRequisites.ledgers,"label-prop":"name","value-prop":"uuid",error:e(P).ledger,"onUpdate:error":u[5]||(u[5]=t=>e(P).ledger=t)},null,8,["modelValue","label","options","error"])]),f("div",Ce,[o(D,{modelValue:g.selectedPaymentMethod,"onUpdate:modelValue":u[6]||(u[6]=t=>g.selectedPaymentMethod=t),name:"paymentMethod",label:w.$trans("finance.payment_method.payment_method"),options:m.preRequisites.paymentMethods,"object-prop":!0,"label-prop":"name","value-prop":"uuid",error:e(P).paymentMethod,"onUpdate:error":u[7]||(u[7]=t=>e(P).paymentMethod=t),onChange:i},null,8,["modelValue","label","options","error"])]),g.selectedPaymentMethod?(l(),U(G,{key:0,"selected-payment-method":g.selectedPaymentMethod,instrumentNumber:c.instrumentNumber,"onUpdate:instrumentNumber":u[8]||(u[8]=t=>c.instrumentNumber=t),instrumentDate:c.instrumentDate,"onUpdate:instrumentDate":u[9]||(u[9]=t=>c.instrumentDate=t),clearingDate:c.clearingDate,"onUpdate:clearingDate":u[10]||(u[10]=t=>c.clearingDate=t),bankDetail:c.bankDetail,"onUpdate:bankDetail":u[11]||(u[11]=t=>c.bankDetail=t),referenceNumber:c.referenceNumber,"onUpdate:referenceNumber":u[12]||(u[12]=t=>c.referenceNumber=t),formErrors:e(P),"onUpdate:formErrors":u[13]||(u[13]=t=>ue(P)?P.value=t:null)},null,8,["selected-payment-method","instrumentNumber","instrumentDate","clearingDate","bankDetail","referenceNumber","formErrors"])):y("",!0),f("div",we,[o(C,{rows:1,modelValue:c.remarks,"onUpdate:modelValue":u[14]||(u[14]=t=>c.remarks=t),name:"remarks",label:w.$trans("student.payment.props.remarks"),error:e(P).remarks,"onUpdate:error":u[15]||(u[15]=t=>e(P).remarks=t)},null,8,["modelValue","label","error"])])])]),_:1},8,["uuid","module-uuid","form","submit-text"])}}}),je={key:0,class:"mb-4"},Me={class:"grid grid-cols-1 sm:grid-cols-3 gap-x-4 gap-y-8"},Re={class:"mt-8 grid grid-cols-1 sm:grid-cols-3 gap-x-4 gap-y-8"},Se={class:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4"},Ne={class:"col-span-3"},Ae={class:"col-span-3 sm:col-span-1"},qe={class:"col-span-3 sm:col-span-1"},Ie={class:"col-span-3 sm:col-span-1"},Ee={class:"col-span-3"},Oe={key:1,class:"col-span-3"},Te={key:3,class:"mt-8 flex justify-between"},Ge={class:"flex space-x-2 sm:space-x-4"},He={class:"flex space-x-2 sm:space-x-4"},Le={name:"StudentFeePaymentDetail"},ze=Object.assign(Le,{props:{visibility:{type:Boolean,default:!1},transaction:{type:Object,default(){return{}}},preRequisites:{type:Object,default(){return{}}}},emits:["close","refresh"],setup(m,{emit:X}){const z=ae(),J=ne(),I=X,V=m,n=le("$trans"),P={isRejected:!1,rejectedDate:"",rejectionCharge:"",customFeeHead:"",rejectionRemarks:"",cancellationRemarks:""},g="student/payment/",c=re(g),i=te(!1),N=te(!1),w=te(!1);K({});const u=K({isPaymentPreRequisiteSet:!1}),A=K({paymentMethods:[],ledgers:[]}),M=K({...P}),D=()=>{I("close")},G=async()=>{u.isPaymentPreRequisiteSet||await C(),N.value=!0},C=async()=>{i.value=!0,await J.dispatch("student/payment/preRequisite",{uuid:z.params.uuid}).then(a=>{Object.assign(A,a),u.isPaymentPreRequisiteSet=!0,i.value=!1}).catch(a=>{i.value=!1})},h=()=>{window.open(`/app/students/${z.params.uuid}/transactions/${V.transaction.uuid}/export?action=print`)},t=()=>{N.value=!1,w.value=!1,I("close"),I("refresh")};return(a,v)=>{const W=$("BaseBadge"),x=$("BaseAlert"),O=$("BaseDataView"),ee=$("PaymentMethodDetail"),Y=$("BaseSwitch"),q=$("DatePicker"),E=$("BaseInput"),r=$("BaseSelect"),B=$("BaseTextarea"),R=$("FormAction"),p=$("BaseButton"),H=$("BaseModal");return m.transaction.uuid?(l(),U(H,{key:0,"is-loading":i.value,show:m.visibility,onClose:D},{title:s(()=>[b(d(e(n)("global.detail",{attribute:e(n)("student.payment.payment")}))+" ",1),m.transaction.isCancelled?(l(),U(W,{key:0,design:"danger"},{default:s(()=>[b(d(e(n)("general.cancelled")),1)]),_:1})):y("",!0),m.transaction.isRejected?(l(),U(W,{key:1,design:"warning"},{default:s(()=>[b(d(e(n)("general.rejected")),1)]),_:1})):y("",!0)]),default:s(()=>[m.transaction.records.length>1?(l(),k("div",je,[o(x,{size:"xs",design:"info"},{default:s(()=>[b(d(e(n)("student.fee.multi_installment_payment_info")),1)]),_:1})])):y("",!0),f("dl",Me,[o(O,{label:e(n)("finance.transaction.props.code_number")},{default:s(()=>[b(d(m.transaction.codeNumber),1)]),_:1},8,["label"]),o(O,{label:e(n)("finance.transaction.props.date")},{default:s(()=>[b(d(m.transaction.date.formatted),1)]),_:1},8,["label"]),o(O,{label:e(n)("finance.transaction.props.amount")},{default:s(()=>[b(d(m.transaction.amount.formatted),1)]),_:1},8,["label"]),o(O,{label:e(n)("finance.payment_method.payment_method")},{default:s(()=>[o(ee,{payments:m.transaction.payments},null,8,["payments"])]),_:1},8,["label"])]),f("dl",Re,[m.transaction.remarks?(l(),U(O,{key:0,label:e(n)("student.payment.props.remarks"),class:"col-span-1 sm:col-span-3"},{default:s(()=>[b(d(m.transaction.remarks),1)]),_:1},8,["label"])):y("",!0),m.transaction.isRejected?(l(),k(S,{key:1},[o(O,{label:e(n)("finance.transaction.props.rejected_date")},{default:s(()=>[b(d(m.transaction.rejectedDate.formatted),1)]),_:1},8,["label"]),o(O,{label:e(n)("finance.transaction.props.rejection_charge")},{default:s(()=>[b(d(m.transaction.rejectionCharge.formatted),1)]),_:1},8,["label"]),o(O,{label:e(n)("finance.transaction.props.rejection_remarks"),class:"col-span-1 sm:col-span-3"},{default:s(()=>[b(d(m.transaction.rejectionRemarks),1)]),_:1},8,["label"])],64)):y("",!0),m.transaction.cancellationRemarks?(l(),U(O,{key:2,label:e(n)("finance.transaction.props.cancellation_remarks"),class:"col-span-1 sm:col-span-3"},{default:s(()=>[b(d(m.transaction.cancellationRemarks),1)]),_:1},8,["label"])):y("",!0),o(O,{label:e(n)("user.user")},{default:s(()=>[b(d(m.transaction.userName),1)]),_:1},8,["label"]),o(O,{label:e(n)("general.created_at")},{default:s(()=>[b(d(m.transaction.createdAt.formatted),1)]),_:1},8,["label"]),o(O,{label:e(n)("general.updated_at")},{default:s(()=>[b(d(m.transaction.updatedAt.formatted),1)]),_:1},8,["label"])]),w.value?(l(),U(R,{key:1,"no-card":"","no-data-fetch":"","is-modal":"",confirmation:"",uuid:e(z).params.uuid,"module-uuid":m.transaction.uuid,action:"cancelPayment","init-url":g,"init-form":P,form:M,"keep-adding":!1,"cancel-action":!1,"submit-text":e(n)("global.cancel",{attribute:e(n)("student.payment.payment")}),onRedirectTo:t,onCancelled:v[12]||(v[12]=F=>w.value=!1)},{default:s(()=>[f("div",Se,[f("div",Ne,[o(Y,{vertical:"",modelValue:M.isRejected,"onUpdate:modelValue":v[0]||(v[0]=F=>M.isRejected=F),name:"isRejected",label:e(n)("finance.transaction.props.payment_rejected"),error:e(c).isRejected,"onUpdate:error":v[1]||(v[1]=F=>e(c).isRejected=F)},null,8,["modelValue","label","error"])]),M.isRejected?(l(),k(S,{key:0},[f("div",Ae,[o(q,{modelValue:M.rejectedDate,"onUpdate:modelValue":v[2]||(v[2]=F=>M.rejectedDate=F),name:"rejectedDate",label:e(n)("finance.transaction.props.rejected_date"),"no-clear":"",error:e(c).rejectedDate,"onUpdate:error":v[3]||(v[3]=F=>e(c).rejectedDate=F)},null,8,["modelValue","label","error"])]),f("div",qe,[o(E,{currency:"",modelValue:M.rejectionCharge,"onUpdate:modelValue":v[4]||(v[4]=F=>M.rejectionCharge=F),name:"rejectionCharge",label:e(n)("finance.transaction.props.rejection_charge"),error:e(c).rejectionCharge,"onUpdate:error":v[5]||(v[5]=F=>e(c).rejectionCharge=F)},null,8,["modelValue","label","error"])]),f("div",Ie,[o(r,{modelValue:M.customFeeHead,"onUpdate:modelValue":v[6]||(v[6]=F=>M.customFeeHead=F),name:"customFeeHead",label:e(n)("student.fee.custom_fee"),"label-prop":"name","value-prop":"uuid",options:m.preRequisites.customFeeHeads,error:e(c).customFeeHead,"onUpdate:error":v[7]||(v[7]=F=>e(c).customFeeHead=F)},null,8,["modelValue","label","options","error"])]),f("div",Ee,[o(B,{modelValue:M.rejectionRemarks,"onUpdate:modelValue":v[8]||(v[8]=F=>M.rejectionRemarks=F),name:"rejectionRemarks",label:e(n)("finance.transaction.props.rejection_remarks"),error:e(c).rejectionRemarks,"onUpdate:error":v[9]||(v[9]=F=>e(c).rejectionRemarks=F)},null,8,["modelValue","label","error"])])],64)):(l(),k("div",Oe,[o(B,{modelValue:M.cancellationRemarks,"onUpdate:modelValue":v[10]||(v[10]=F=>M.cancellationRemarks=F),name:"cancellationRemarks",label:e(n)("finance.transaction.props.cancellation_remarks"),error:e(c).cancellationRemarks,"onUpdate:error":v[11]||(v[11]=F=>e(c).cancellationRemarks=F)},null,8,["modelValue","label","error"])]))])]),_:1},8,["uuid","module-uuid","form","submit-text"])):y("",!0),N.value?(l(),U(Be,{key:2,transaction:m.transaction,"pre-requisites":A,onClose:v[13]||(v[13]=F=>N.value=!1),onRefresh:t},null,8,["transaction","pre-requisites"])):y("",!0),!w.value&&!N.value?(l(),k("div",Te,[f("div",Ge,[e(Z)("fee:cancel-payment")&&!m.transaction.isCancelled&&!m.transaction.isRejected&&!m.transaction.isOnline?(l(),U(p,{key:0,design:"danger",onClick:v[14]||(v[14]=F=>w.value=!0)},{default:s(()=>[b(d(e(n)("global.cancel",{attribute:e(n)("student.payment.payment")})),1)]),_:1})):y("",!0)]),f("div",He,[m.transaction.isEditable&&e(Z)("fee:edit-payment")?(l(),U(p,{key:0,design:"primary",onClick:G},{default:s(()=>[b(d(e(n)("general.edit")),1)]),_:1})):y("",!0),o(p,{design:"success",onClick:h},{default:s(()=>[b(d(e(n)("general.print")),1)]),_:1})])])):y("",!0)]),_:1},8,["is-loading","show"])):y("",!0)}}}),We={class:"grid grid-cols-1 sm:grid-cols-3 gap-x-4 gap-y-8 mb-4"},Je={class:"grid grid-cols-3 gap-4"},Ke={class:"col-span-3 sm:col-span-1"},Ze={key:0,class:"col-span-3 sm:col-span-1"},xe={key:1,class:"col-span-3 sm:col-span-1"},Qe={class:"mt-4 grid grid-cols-3 gap-4"},Xe={class:"col-span-3 sm:col-span-1"},Ye={class:"col-span-3 sm:col-span-1"},et={class:"mt-4 grid grid-cols-3 gap-4"},tt={class:"col-span-3 sm:col-span-1"},at={class:"col-span-3 sm:col-span-1"},nt={class:"mt-4 grid grid-cols-3 gap-4"},st={class:"col-span-3 sm:col-span-1"},lt={class:"col-span-3 sm:col-span-1"},ot={class:"mt-4 grid grid-cols-3 gap-4"},rt={class:"col-span-3 sm:col-span-1"},it={class:"col-span-3 sm:col-span-1"},dt={class:"col-span-3 sm:col-span-1"},ut={class:"col-span-3"},mt={name:"StudentFeePaymentForm"},ct=Object.assign(mt,{props:{visibility:{type:Boolean,default:!1},date:{type:Object,default(){return{}}},fee:{type:Object,default(){return{}}},feeGroup:{type:Object,default(){return{}}},feeHead:{type:Object,default(){return{}}},preRequisites:{type:Object,default(){return{}}}},emits:["close","completed"],setup(m,{emit:X}){const z=ae(),J=ne(),I=X,V=m,n={codeNumber:"",feeHead:null,feeGroup:null,feeInstallment:null,additionalCharges:[],additionalDiscounts:[],date:"",lateFee:0,amount:"",ledger:"",paymentMethod:"",instrumentNumber:"",instrumentDate:"",clearingDate:"",bankDetail:"",referenceNumber:"",remarks:""},P="student/payment/",g=re(P),c=K({initialAmount:0,showAdditionalCharge:!1,showAdditionalDiscount:!1,selectedPaymentMethod:{}}),i=K({...n}),N=C=>{i.paymentMethod=C?C.uuid:{},c.selectedPaymentMethod=C||{}},w=()=>{A(),I("close")},u=()=>{A(),I("completed")},A=()=>{n.lateFee=0,n.date="",n.feeGroup=null,n.feeHead=null,n.feeInstallment=null,n.amount="",c.selectedPaymentMethod={},c.showAdditionalCharge=!1,c.showAdditionalDiscount=!1,Object.assign(i,n),J.dispatch(P+"resetFormErrors")},M=C=>{let h=parseFloat(c.initialAmount);i.lateFee&&(h+=parseFloat(i.lateFee)),i.additionalCharges.forEach(t=>{t.amount&&(h+=parseFloat(t.amount))}),i.additionalDiscounts.forEach(t=>{t.amount&&(h-=parseFloat(t.amount))}),i.amount=h},D=()=>{c.selectedPaymentMethod={},G(),Object.assign(i,n)},G=()=>{n.additionalCharges=[],n.additionalCharges.push({uuid:oe(),label:"",amount:0}),n.additionalDiscounts=[],n.additionalDiscounts.push({uuid:oe(),label:"",amount:0})};return be(()=>{var C,h,t;if(V.feeGroup.uuid){n.feeGroup=V.feeGroup.uuid;let a=V.feeGroup.lateFee.value;a>0&&(n.lateFee=a),n.amount=V.feeGroup.balance.value}else if(V.feeHead.uuid)n.feeHead=V.feeHead.uuid,n.amount=V.feeHead.balance.value;else if(V.fee.uuid){n.feeInstallment=V.fee.uuid;let a=((h=(C=V.fee.lateFee)==null?void 0:C.amount)==null?void 0:h.value)||0;a>0&&(n.lateFee=a),n.amount=V.fee.balance.value}c.initialAmount=n.amount-n.lateFee,n.date=(t=V.date)==null?void 0:t.value,G(),Object.assign(i,n)}),ge(()=>{A()}),(C,h)=>{const t=$("BaseDataView"),a=$("BaseInput"),v=$("DatePicker"),W=$("BaseSwitch"),x=$("BaseFieldset"),O=$("BaseSelect"),ee=$("PaymentMethodInput"),Y=$("BaseTextarea"),q=$("FormAction"),E=$("BaseModal");return l(),U(E,{show:m.visibility,onClose:w},{title:s(()=>[b(d(C.$trans("global.pay",{attribute:C.$trans("student.fee.fee")})),1)]),default:s(()=>[f("dl",We,[o(t,{label:C.$trans("general.date")},{default:s(()=>[b(d(m.date.formatted),1)]),_:1},8,["label"]),m.feeGroup.uuid?(l(),k(S,{key:0},[o(t,{label:C.$trans("finance.fee_group.fee_group")},{default:s(()=>[b(d(m.feeGroup.name),1)]),_:1},8,["label"]),o(t,{label:C.$trans("finance.fee.balance")},{default:s(()=>[b(d(m.feeGroup.balance.formatted),1)]),_:1},8,["label"])],64)):m.feeHead.uuid?(l(),k(S,{key:1},[o(t,{label:C.$trans("finance.fee_head.fee_head")},{default:s(()=>[b(d(m.feeHead.name),1)]),_:1},8,["label"]),o(t,{label:C.$trans("finance.fee.balance")},{default:s(()=>[b(d(m.feeHead.balance.formatted),1)]),_:1},8,["label"])],64)):m.fee.uuid?(l(),k(S,{key:2},[o(t,{label:C.$trans("finance.fee_structure.installment")},{default:s(()=>[b(d(m.fee.installment.title),1)]),_:1},8,["label"]),o(t,{label:C.$trans("finance.fee.balance")},{default:s(()=>[b(d(m.fee.balance.formatted),1)]),_:1},8,["label"])],64)):y("",!0)]),o(q,{"no-card":"","no-data-fetch":"","is-modal":"",uuid:e(z).params.uuid,action:"makePayment","init-url":P,"init-form":n,form:i,"keep-adding":!1,"cancel-action":!0,"after-reset":D,onRedirectTo:u,onCancelled:w},{default:s(()=>[f("div",Je,[f("div",Ke,[o(a,{modelValue:i.codeNumber,"onUpdate:modelValue":h[0]||(h[0]=r=>i.codeNumber=r),name:"codeNumber",label:C.$trans("finance.transaction.props.code_number"),error:e(g).codeNumber,"onUpdate:error":h[1]||(h[1]=r=>e(g).codeNumber=r)},null,8,["modelValue","label","error"])]),e(Z)("fee:change-payment-date")?(l(),k("div",Ze,[o(v,{modelValue:i.date,"onUpdate:modelValue":h[2]||(h[2]=r=>i.date=r),name:"date","no-clear":"",label:C.$trans("student.fee.props.date"),error:e(g).date,"onUpdate:error":h[3]||(h[3]=r=>e(g).date=r)},null,8,["modelValue","label","error"])])):y("",!0),e(Z)("fee:customize-late-fee")?(l(),k("div",xe,[o(a,{modelValue:i.lateFee,"onUpdate:modelValue":h[4]||(h[4]=r=>i.lateFee=r),name:"lateFee",currency:"",label:C.$trans("finance.fee.default_fee_heads.late_fee"),error:e(g).lateFee,"onUpdate:error":h[5]||(h[5]=r=>e(g).lateFee=r),onChange:M},null,8,["modelValue","label","error"])])):y("",!0)]),f("div",Qe,[f("div",Xe,[o(W,{vertical:"",modelValue:c.showAdditionalCharge,"onUpdate:modelValue":h[6]||(h[6]=r=>c.showAdditionalCharge=r),name:"showAdditionalCharge",label:C.$trans("global.show",{attribute:C.$trans("student.fee.props.additional_charge")})},null,8,["modelValue","label"])]),f("div",Ye,[o(W,{vertical:"",modelValue:c.showAdditionalDiscount,"onUpdate:modelValue":h[7]||(h[7]=r=>c.showAdditionalDiscount=r),name:"showAdditionalDiscount",label:C.$trans("global.show",{attribute:C.$trans("student.fee.props.additional_discount")})},null,8,["modelValue","label"])])]),c.showAdditionalCharge?(l(!0),k(S,{key:0},Q(i.additionalCharges,(r,B)=>(l(),U(x,{class:"mt-4",key:r.uuid},{legend:s(()=>[b(d(C.$trans("student.fee.props.additional_charge")),1)]),default:s(()=>[f("div",et,[f("div",tt,[o(a,{modelValue:r.label,"onUpdate:modelValue":R=>r.label=R,name:`additionalCharges.${B}.label`,label:C.$trans("student.fee.props.additional_charge_label"),error:e(g)[`additionalCharges.${B}.label`],"onUpdate:error":R=>e(g)[`additionalCharges.${B}.label`]=R},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])]),f("div",at,[o(a,{modelValue:r.amount,"onUpdate:modelValue":R=>r.amount=R,name:`additionalCharges.${B}.amount`,label:C.$trans("student.fee.props.additional_charge_amount"),currency:"",onChange:M,error:e(g)[`additionalCharges.${B}.amount`],"onUpdate:error":R=>e(g)[`additionalCharges.${B}.amount`]=R},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])])])]),_:2},1024))),128)):y("",!0),c.showAdditionalDiscount?(l(!0),k(S,{key:1},Q(i.additionalDiscounts,(r,B)=>(l(),U(x,{class:"mt-4",key:r.uuid},{legend:s(()=>[b(d(C.$trans("student.fee.props.additional_discount")),1)]),default:s(()=>[f("div",nt,[f("div",st,[o(a,{modelValue:r.label,"onUpdate:modelValue":R=>r.label=R,name:`additionalDiscounts.${B}.label`,label:C.$trans("student.fee.props.additional_discount_label"),error:e(g)[`additionalDiscounts.${B}.label`],"onUpdate:error":R=>e(g)[`additionalDiscounts.${B}.label`]=R},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])]),f("div",lt,[o(a,{modelValue:r.amount,"onUpdate:modelValue":R=>r.amount=R,name:`additionalDiscounts.${B}.amount`,label:C.$trans("student.fee.props.additional_discount_amount"),currency:"",onChange:M,error:e(g)[`additionalDiscounts.${B}.amount`],"onUpdate:error":R=>e(g)[`additionalDiscounts.${B}.amount`]=R},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])])])]),_:2},1024))),128)):y("",!0),f("div",ot,[f("div",rt,[o(a,{disabled:!e(Z)("fee:partial-payment"),modelValue:i.amount,"onUpdate:modelValue":h[8]||(h[8]=r=>i.amount=r),name:"amount",label:C.$trans("student.fee.props.amount"),currency:"",error:e(g).amount,"onUpdate:error":h[9]||(h[9]=r=>e(g).amount=r)},null,8,["disabled","modelValue","label","error"])]),f("div",it,[o(O,{modelValue:i.ledger,"onUpdate:modelValue":h[10]||(h[10]=r=>i.ledger=r),name:"ledger",label:C.$trans("finance.ledger.ledger"),options:m.preRequisites.ledgers,"label-prop":"name","value-prop":"uuid",error:e(g).ledger,"onUpdate:error":h[11]||(h[11]=r=>e(g).ledger=r)},null,8,["modelValue","label","options","error"])]),f("div",dt,[o(O,{modelValue:c.selectedPaymentMethod,"onUpdate:modelValue":h[12]||(h[12]=r=>c.selectedPaymentMethod=r),name:"paymentMethod",label:C.$trans("finance.payment_method.payment_method"),options:m.preRequisites.paymentMethods,"object-prop":!0,"label-prop":"name","value-prop":"uuid",error:e(g).paymentMethod,"onUpdate:error":h[13]||(h[13]=r=>e(g).paymentMethod=r),onChange:N},null,8,["modelValue","label","options","error"])]),c.selectedPaymentMethod?(l(),U(ee,{key:0,"selected-payment-method":c.selectedPaymentMethod,instrumentNumber:i.instrumentNumber,"onUpdate:instrumentNumber":h[14]||(h[14]=r=>i.instrumentNumber=r),instrumentDate:i.instrumentDate,"onUpdate:instrumentDate":h[15]||(h[15]=r=>i.instrumentDate=r),clearingDate:i.clearingDate,"onUpdate:clearingDate":h[16]||(h[16]=r=>i.clearingDate=r),bankDetail:i.bankDetail,"onUpdate:bankDetail":h[17]||(h[17]=r=>i.bankDetail=r),referenceNumber:i.referenceNumber,"onUpdate:referenceNumber":h[18]||(h[18]=r=>i.referenceNumber=r),formErrors:e(g),"onUpdate:formErrors":h[19]||(h[19]=r=>ue(g)?g.value=r:null)},null,8,["selected-payment-method","instrumentNumber","instrumentDate","clearingDate","bankDetail","referenceNumber","formErrors"])):y("",!0),f("div",ut,[o(Y,{rows:1,modelValue:i.remarks,"onUpdate:modelValue":h[20]||(h[20]=r=>i.remarks=r),name:"remarks",label:C.$trans("student.payment.props.remarks"),error:e(g).remarks,"onUpdate:error":h[21]||(h[21]=r=>e(g).remarks=r)},null,8,["modelValue","label","error"])])])]),_:1},8,["uuid","form"])]),_:1},8,["show"])}}}),pt={class:"flex justify-start"},ft={key:0},bt={class:"text-right sm:text-left"},gt={key:0},yt={key:1,class:"text-xs"},ht={key:2,class:"text-xs"},vt={class:"mt-4 justify-end md:justify-start flex flex-wrap gap-1"},kt={class:"text-right sm:text-left"},$t={class:"ml-2"},_t={key:1},Dt={key:2,class:"text-xs"},Vt={key:0,class:"flex justify-between"},Ft={key:0,class:"line-through mr-2"},Ut={key:0,class:"flex justify-between"},Ct={key:0,class:"flex justify-between"},wt={class:"truncate"},Pt={key:0,class:"flex justify-between"},Bt={class:"truncate"},jt={class:"flex justify-start"},Mt={name:"StudentFeeGroupList"},Rt=Object.assign(Mt,{props:{state:{type:Object,default(){return{}}}},emits:["setIsLoading","refresh"],setup(m,{emit:X}){const z=ae(),J=ne(),I=X,V=m,n=le("$trans"),{screenSize:P}=he(),g=[{key:"title",label:n("finance.fee_structure.props.title"),visibility:!0},{key:"dueDate",label:n("finance.fee_structure.props.due_date"),visibility:!0},{key:"fee",label:n("student.fee.fee"),visibility:!0},{key:"total",label:n("finance.fee.total"),visibility:!0,align:"right"},{key:"paid",label:n("finance.fee.paid"),visibility:!0,align:"right"},{key:"balance",label:n("finance.fee.balance"),visibility:!0,align:"right"},{key:"action",label:"",visibility:!0}],c=q=>V.state.fees.filter(E=>E.installment.group.uuid==q.uuid),i=q=>V.state.transactions.filter(E=>E.records.filter(r=>r.studentFeeUuid==q.uuid).length>0);te(!1);const N=te(!1),w=te(!1),u=te(!1),A=K({isPaymentPreRequisiteSet:!1,isPreRequisiteSet:!1});K({directions:[],transportCircles:[],feeConcessions:[],frequencies:[]});const M=K({paymentMethods:[],ledgers:[]}),D=K({feeGroup:{},fee:{},transaction:{}}),G=async(q="payment")=>{I("setIsLoading",!0),await J.dispatch("student/payment/preRequisite",{uuid:z.params.uuid,type:q}).then(E=>{Object.assign(M,E),A.isPaymentPreRequisiteSet=!0,I("setIsLoading",!1)}).catch(E=>{I("setIsLoading",!1)})},C=q=>{let E=V.state.transactions.filter(B=>B.records.filter(R=>R.additionalCharges.length>0).length>0),r=[];return E.filter(B=>!B.isCancelled&&!B.isRejected).forEach(B=>{B.records.forEach(R=>{R.studentFeeUuid==q.uuid&&r.push(...R.additionalCharges)})}),r},h=q=>{let E=V.state.transactions.filter(B=>B.records.filter(R=>R.additionalDiscounts.length>0).length>0),r=[];return E.filter(B=>!B.isCancelled&&!B.isRejected).forEach(B=>{B.records.forEach(R=>{R.studentFeeUuid==q.uuid&&r.push(...R.additionalDiscounts)})}),r},t=async(q={})=>{A.isPaymentPreRequisiteSet||await G("custom_fee"),D.transaction=q,u.value=!0},a=async(q={})=>{A.isPaymentPreRequisiteSet||await G(),D.feeGroup={},D.fee=q,N.value=!0},v=async(q={})=>{A.isPaymentPreRequisiteSet||await G(),D.fee={},D.feeGroup=q,N.value=!0},W=async(q={})=>{A.isPaymentPreRequisiteSet||await G(),D.feeGroup={},D.fee=q,w.value=!0},x=async(q={})=>{A.isPaymentPreRequisiteSet||await G(),D.fee={},D.feeGroup=q,w.value=!0},O=()=>{N.value=!1,w.value=!1,D.fee={},D.feeGroup={}},ee=()=>{D.transaction={},u.value=!1},Y=()=>{D.fee={},D.feeGroup={},O(),I("refresh")};return(q,E)=>{const r=$("DataCell"),B=$("BaseButton"),R=$("FloatingMenuItem"),p=$("FloatingMenu"),H=$("DataRow"),F=$("BaseBadge"),ye=$("SimpleTable");return l(),k(S,null,[m.state.fees.length>0?(l(),U(ye,{key:0,corner:"sharp",header:g},{default:s(()=>[(l(!0),k(S,null,Q(m.state.feeGroups,T=>(l(),k(S,null,[o(H,{"is-heading":""},{default:s(()=>[o(r,{name:"title",colspan:3,"is-heading":""},{default:s(()=>[f("div",pt,[f("span",null,[T.status.value=="paid"?(l(),k("span",ft,E[1]||(E[1]=[f("i",{class:"fas fa-check-circle text-success mr-1"},null,-1)]))):y("",!0),b(" "+d(T.name),1)])])]),_:2},1024),o(r,{name:"total",align:"right","is-heading":""},{default:s(()=>[b(d(T.total.formatted),1)]),_:2},1024),o(r,{name:"paid",align:"right","is-heading":""},{default:s(()=>[b(d(T.paid.formatted),1)]),_:2},1024),o(r,{name:"balance",align:"right","is-heading":""},{default:s(()=>[b(d(T.balance.formatted),1)]),_:2},1024),o(r,{streched:""},{default:s(()=>[e(Z)("fee:payment")?(l(),k(S,{key:0},[!e(se)(["student","guardian"],"any")&&e(P).small&&T.balance.value>0?(l(),U(B,{key:0,block:"",onClick:j=>v(T)},{default:s(()=>[b(d(e(n)("global.pay",{attribute:e(n)("finance.fee_group.fee_group")})),1)]),_:2},1032,["onClick"])):y("",!0),e(P).small&&T.balance.value>0?(l(),U(B,{key:1,block:"",onClick:j=>x(T)},{default:s(()=>[b(d(e(n)("finance.payment.online")),1)]),_:2},1032,["onClick"])):y("",!0)],64)):y("",!0),e(P).small?y("",!0):(l(),U(p,{key:1,slim:""},{default:s(()=>[e(Z)("fee:payment")?(l(),k(S,{key:0},[!e(se)(["student","guardian"],"any")&&T.balance.value>0?(l(),U(R,{key:0,onClick:j=>v(T)},{default:s(()=>[b(d(e(n)("global.pay",{attribute:e(n)("finance.fee_group.fee_group")})),1)]),_:2},1032,["onClick"])):y("",!0),T.balance.value>0?(l(),U(R,{key:1,onClick:j=>x(T)},{default:s(()=>[b(d(e(n)("finance.payment.online")),1)]),_:2},1032,["onClick"])):y("",!0)],64)):y("",!0)]),_:2},1024))]),_:2},1024)]),_:2},1024),(l(!0),k(S,null,Q(c(T),(j,ha)=>(l(),U(H,{key:j.uuid},{default:s(()=>[o(r,{name:"title"},{default:s(()=>[f("div",bt,[j.status.value=="paid"?(l(),k("span",gt,E[2]||(E[2]=[f("i",{class:"fas fa-check-circle text-success mr-1"},null,-1)]))):y("",!0),b(" "+d(j.installment.title)+" ",1),j.transportCircle?(l(),k("p",yt,d(j.transportCircle.name),1)):y("",!0),j.concession?(l(),k("p",ht,d(j.concession.name),1)):y("",!0),f("div",vt,[(l(!0),k(S,null,Q(i(j),L=>(l(),U(F,{key:L.uuid,size:"sm",clickable:"",design:L.design,onClick:ie=>t(L)},{default:s(()=>[b(d(L.codeNumber),1)]),_:2},1032,["design","onClick"]))),128))])])]),_:2},1024),o(r,{name:"dueDate"},{default:s(()=>[f("div",kt,[j.overdue?(l(),U(F,{key:0,design:"error"},{default:s(()=>[b(d(j.dueDate.formatted)+" ",1),f("span",$t,"("+d(j.overdue+" "+e(n)("list.durations.day"))+")",1)]),_:2},1024)):y("",!0),j.overdue===0?(l(),k("p",_t,d(j.dueDate.formatted),1)):y("",!0),j.lateFeeApplicable?(l(),k("p",Dt,d(e(n)("finance.fee_structure.props.late_fee"))+" "+d(j.lateFee.formatted),1)):y("",!0)])]),_:2},1024),o(r,{name:"fee",streched:"",table:""},{default:s(()=>[(l(!0),k(S,null,Q(j.records,L=>{var ie,me;return l(),k(S,null,[L.amount.value>0?(l(),k("div",Vt,[b(d(((ie=L.head)==null?void 0:ie.name)||((me=L.defaultFeeHead)==null?void 0:me.label)||"-")+" ",1),f("div",null,[L.concession.value>0?(l(),k("span",Ft,d(L.amount.formatted),1)):y("",!0),f("span",null,d(L.amountWithConcession.formatted),1)])])):y("",!0)],64)}),256)),j.lateFee.amount.value>0?(l(),k("div",Ut,[b(d(e(n)("finance.fee_structure.late_fee"))+" ",1),f("div",null,[f("span",null,d(j.lateFee.amount.formatted),1)])])):y("",!0),(l(!0),k(S,null,Q(C(j),L=>(l(),k(S,null,[L.amount.value>0?(l(),k("div",Ct,[f("span",wt,d(L.label),1),f("div",null,[f("span",null,d(L.amount.formatted),1)])])):y("",!0)],64))),256)),(l(!0),k(S,null,Q(h(j),L=>(l(),k(S,null,[L.amount.value>0?(l(),k("div",Pt,[f("span",Bt,d(L.label),1),f("div",null,[f("span",null,"(-)"+d(L.amount.formatted),1)])])):y("",!0)],64))),256))]),_:2},1024),o(r,{align:"right",name:"total"},{default:s(()=>[b(d(j.total.formatted),1)]),_:2},1024),o(r,{align:"right",name:"paid"},{default:s(()=>[b(d(j.paid.formatted),1)]),_:2},1024),o(r,{align:"right",name:"balance"},{default:s(()=>[b(d(j.balance.formatted),1)]),_:2},1024),o(r,{name:"action",streched:""},{default:s(()=>[e(Z)("fee:payment")?(l(),k(S,{key:0},[!e(se)(["student","guardian"],"any")&&e(P).small&&j.balance.value>0?(l(),U(B,{key:0,block:"",onClick:L=>a(j)},{default:s(()=>[b(d(e(n)("global.pay",{attribute:e(n)("finance.fee_structure.installment")})),1)]),_:2},1032,["onClick"])):y("",!0),e(P).small&&j.balance.value>0?(l(),U(B,{key:1,block:"",onClick:L=>W(j)},{default:s(()=>[b(d(e(n)("finance.payment.online")),1)]),_:2},1032,["onClick"])):y("",!0)],64)):y("",!0),e(P).small?y("",!0):(l(),U(p,{key:1},{default:s(()=>[e(Z)("fee:payment")?(l(),k(S,{key:0},[!e(se)(["student","guardian"],"any")&&j.balance.value>0?(l(),U(R,{key:0,icon:"fas fa-credit-card",onClick:L=>a(j)},{default:s(()=>[b(d(e(n)("global.pay",{attribute:e(n)("finance.fee_structure.installment")})),1)]),_:2},1032,["onClick"])):y("",!0),j.balance.value>0?(l(),U(R,{key:1,icon:"fas fa-credit-card",onClick:L=>W(j)},{default:s(()=>[b(d(e(n)("finance.payment.online")),1)]),_:2},1032,["onClick"])):y("",!0)],64)):y("",!0)]),_:2},1024))]),_:2},1024)]),_:2},1024))),128))],64))),256)),m.state.summary?(l(),U(H,{key:0,"is-heading":""},{default:s(()=>[o(r,{name:"title",colspan:3,"is-heading":""},{default:s(()=>[f("div",jt,[f("span",null,d(e(n)("global.grand",{attribute:e(n)("finance.fee.total")})),1)])]),_:1}),o(r,{name:"total",align:"right","is-heading":""},{default:s(()=>{var T;return[b(d((T=m.state.summary.grandTotal)==null?void 0:T.formatted),1)]}),_:1}),o(r,{name:"paid",align:"right","is-heading":""},{default:s(()=>{var T;return[b(d((T=m.state.summary.grandTotalPaid)==null?void 0:T.formatted),1)]}),_:1}),o(r,{name:"balance",align:"right","is-heading":""},{default:s(()=>{var T;return[b(d((T=m.state.summary.grandTotalBalance)==null?void 0:T.formatted),1)]}),_:1}),o(r)]),_:1})):y("",!0)]),_:1})):y("",!0),e(se)(["student","guardian"],"any")?y("",!0):(l(),U(ct,{key:1,visibility:N.value,"pre-requisites":M,"fee-group":D.feeGroup,fee:D.fee,date:m.state.date,onClose:O,onCompleted:Y},null,8,["visibility","pre-requisites","fee-group","fee","date"])),o(_e,{visibility:w.value,"pre-requisites":M,"fee-group":D.feeGroup,fee:D.fee,date:m.state.date,onClose:O,onCompleted:Y},null,8,["visibility","pre-requisites","fee-group","fee","date"]),o(ze,{visibility:u.value,transaction:D.transaction,"pre-requisites":M,onClose:ee,onRefresh:E[0]||(E[0]=T=>I("refresh"))},null,8,["visibility","transaction","pre-requisites"])],64)}}}),St={class:"grid grid-cols-3 gap-4"},Nt={class:"col-span-3 sm:col-span-1"},At={key:0,class:"col-span-3 sm:col-span-1"},qt={class:"col-span-3 sm:col-span-1"},It={key:0,class:"mt-4 grid grid-cols-3 gap-4"},Et={class:"col-span-3 sm:col-span-1"},Ot={class:"col-span-3 sm:col-span-1"},Tt={class:"col-span-3 sm:col-span-1"},Gt={key:1,class:"col-span-3"},Ht={class:"mt-4 grid grid-cols-3 gap-4"},Lt={class:"col-span-3 sm:col-span-1"},zt={class:"col-span-3 sm:col-span-1"},Wt={class:"mt-4 grid grid-cols-3 gap-4"},Jt={class:"col-span-3 sm:col-span-1"},Kt={class:"col-span-3 sm:col-span-1"},Zt={class:"mt-4 grid grid-cols-3 gap-4"},xt={class:"col-span-3 sm:col-span-1"},Qt={class:"col-span-3 sm:col-span-1"},Xt={class:"mt-4 grid grid-cols-3 gap-4"},Yt={class:"col-span-3 sm:col-span-1"},ea={class:"col-span-3 sm:col-span-1"},ta={class:"col-span-3 sm:col-span-1"},aa={class:"col-span-3"},na={name:"StudentFeePaymentForm"},sa=Object.assign(na,{props:{visibility:{type:Boolean,default:!1},date:{type:Object,default(){return{}}},feeHeads:{type:Array,default(){return[]}},preRequisites:{type:Object,default(){return{}}}},emits:["close","completed"],setup(m,{emit:X}){const z=ae(),J=ne(),I=X,V=m,n={feeGroup:"",codeNumber:"",date:"",amount:0,lateFee:0,transportFee:0,ledger:"",heads:[],additionalCharges:[],additionalDiscounts:[],paymentMethod:"",instrumentNumber:"",instrumentDate:"",clearingDate:"",bankDetail:"",referenceNumber:"",remarks:""},P="student/payment/",g=re(P),c=K({initialAmount:0,selectedFeeGroup:{},selectedPaymentMethod:{},showAdditionalCharge:!1,showAdditionalDiscount:!1}),i=K({...n}),N=t=>{i.paymentMethod=t?t.uuid:{},c.selectedPaymentMethod=t||{}},w=()=>{A(),I("close")},u=()=>{A(),I("completed")},A=()=>{Object.assign(i,n),c.selectedFeeGroup={},c.selectedPaymentMethod={},c.showAdditionalCharge=!1,c.showAdditionalDiscount=!1,h(),J.dispatch(P+"resetFormErrors")},M=t=>{let a=[];if(_.isEmpty(t)){i.feeGroup="",i.heads=a,i.amount=0,i.lateFee=0;return}i.feeGroup=t.uuid,t.heads.forEach(v=>{let W=V.feeHeads.find(x=>v.uuid==x.uuid);W!=null&&a.push({name:v.name,uuid:v.uuid,total:W.total,paid:W.paid,balance:W.balance,amount:0})}),i.amount=0,i.heads=a},D=()=>{let t=V.feeHeads.find(a=>a.defaultFeeHead=="transport_fee");return t?t.balance:{value:0,formatted:0}},G=t=>{let a=0;i.lateFee&&(a+=parseFloat(i.lateFee)),i.transportFee&&(a+=parseFloat(i.transportFee)),i.heads.forEach(v=>{v.amount&&(a+=parseFloat(v.amount))}),i.additionalCharges.forEach(v=>{v.amount&&(a+=parseFloat(v.amount))}),i.additionalDiscounts.forEach(v=>{v.amount&&(a-=parseFloat(v.amount))}),i.amount=a},C=()=>{A()},h=()=>{n.additionalCharges=[],n.additionalCharges.push({uuid:oe(),label:"",amount:0}),n.additionalDiscounts=[],n.additionalDiscounts.push({uuid:oe(),label:"",amount:0})};return be(()=>{var t;n.date=(t=V.date)==null?void 0:t.value,h(),Object.assign(i,n)}),ge(()=>{A()}),(t,a)=>{const v=$("BaseInput"),W=$("DatePicker"),x=$("BaseSelect"),O=$("TextMuted"),ee=$("BaseAlert"),Y=$("BaseSwitch"),q=$("BaseFieldset"),E=$("PaymentMethodInput"),r=$("BaseTextarea"),B=$("FormAction"),R=$("BaseModal");return l(),U(R,{show:m.visibility,onClose:w},{title:s(()=>[b(d(t.$trans("global.pay",{attribute:t.$trans("student.fee.fee")})),1)]),default:s(()=>[o(B,{"no-card":"","no-data-fetch":"","is-modal":"",uuid:e(z).params.uuid,action:"makeHeadWisePayment","init-url":P,"init-form":n,form:i,"keep-adding":!1,"cancel-action":!0,"after-reset":C,onRedirectTo:u,onCancelled:w},{default:s(()=>[f("div",St,[f("div",Nt,[o(v,{modelValue:i.codeNumber,"onUpdate:modelValue":a[0]||(a[0]=p=>i.codeNumber=p),name:"codeNumber",label:t.$trans("finance.transaction.props.code_number"),error:e(g).codeNumber,"onUpdate:error":a[1]||(a[1]=p=>e(g).codeNumber=p)},null,8,["modelValue","label","error"])]),e(Z)("fee:change-payment-date")?(l(),k("div",At,[o(W,{modelValue:i.date,"onUpdate:modelValue":a[2]||(a[2]=p=>i.date=p),name:"date","no-clear":"",label:t.$trans("student.fee.props.date"),error:e(g).date,"onUpdate:error":a[3]||(a[3]=p=>e(g).date=p)},null,8,["modelValue","label","error"])])):y("",!0),f("div",qt,[o(x,{modelValue:c.selectedFeeGroup,"onUpdate:modelValue":a[4]||(a[4]=p=>c.selectedFeeGroup=p),name:"feeGroup",label:t.$trans("finance.fee_group.fee_group"),options:m.preRequisites.feeGroups,"object-prop":!0,"label-prop":"name","value-prop":"uuid",onChange:M,error:e(g).feeGroup,"onUpdate:error":a[5]||(a[5]=p=>e(g).feeGroup=p)},null,8,["modelValue","label","options","error"])])]),i.feeGroup?(l(),k("div",It,[(l(!0),k(S,null,Q(i.heads,(p,H)=>(l(),k("div",Et,[o(v,{modelValue:p.amount,"onUpdate:modelValue":F=>p.amount=F,name:`heads.${H}.amount`,currency:"",label:p.name,error:e(g)[`heads.${H}.amount`],"onUpdate:error":F=>e(g)[`heads.${H}.amount`]=F,onChange:G},{"additional-label":s(()=>[o(O,null,{default:s(()=>[f("span",{class:ce({"text-danger":p.balance.value<=0,"text-success":p.balance.value>0})},d(t.$trans("finance.fee.balance"))+" "+d(p.balance.formatted),3)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])]))),256)),i.heads.length>0&&!c.selectedFeeGroup.isCustom?(l(),k(S,{key:0},[f("div",Ot,[o(v,{modelValue:i.transportFee,"onUpdate:modelValue":a[6]||(a[6]=p=>i.transportFee=p),name:"transportFee",currency:"",label:t.$trans("finance.fee.default_fee_heads.transport_fee"),error:e(g).transportFee,"onUpdate:error":a[7]||(a[7]=p=>e(g).transportFee=p),onChange:G},{"additional-label":s(()=>[o(O,null,{default:s(()=>[f("span",{class:ce({"text-danger":D().value<=0,"text-success":D().value>0})},d(t.$trans("finance.fee.balance"))+" "+d(D().formatted),3)]),_:1})]),_:1},8,["modelValue","label","error"])]),f("div",Tt,[o(v,{modelValue:i.lateFee,"onUpdate:modelValue":a[8]||(a[8]=p=>i.lateFee=p),name:"lateFee",currency:"",label:t.$trans("finance.fee.default_fee_heads.late_fee"),error:e(g).lateFee,"onUpdate:error":a[9]||(a[9]=p=>e(g).lateFee=p),onChange:G},null,8,["modelValue","label","error"])])],64)):y("",!0),i.heads.length?y("",!0):(l(),k("div",Gt,[o(ee,{design:"info",size:"xs"},{default:s(()=>[b(d(t.$trans("global.could_not_find",{attribute:t.$trans("finance.fee_head.fee_head")})),1)]),_:1})]))])):y("",!0),i.heads.length?(l(),k(S,{key:1},[f("div",Ht,[f("div",Lt,[o(Y,{vertical:"",modelValue:c.showAdditionalCharge,"onUpdate:modelValue":a[10]||(a[10]=p=>c.showAdditionalCharge=p),name:"showAdditionalCharge",label:t.$trans("global.show",{attribute:t.$trans("student.fee.props.additional_charge")})},null,8,["modelValue","label"])]),f("div",zt,[o(Y,{vertical:"",modelValue:c.showAdditionalDiscount,"onUpdate:modelValue":a[11]||(a[11]=p=>c.showAdditionalDiscount=p),name:"showAdditionalDiscount",label:t.$trans("global.show",{attribute:t.$trans("student.fee.props.additional_discount")})},null,8,["modelValue","label"])])]),c.showAdditionalCharge?(l(!0),k(S,{key:0},Q(i.additionalCharges,(p,H)=>(l(),U(q,{class:"mt-4",key:p.uuid},{legend:s(()=>[b(d(t.$trans("student.fee.props.additional_charge")),1)]),default:s(()=>[f("div",Wt,[f("div",Jt,[o(v,{modelValue:p.label,"onUpdate:modelValue":F=>p.label=F,name:`additionalCharges.${H}.label`,label:t.$trans("student.fee.props.additional_charge_label"),error:e(g)[`additionalCharges.${H}.label`],"onUpdate:error":F=>e(g)[`additionalCharges.${H}.label`]=F},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])]),f("div",Kt,[o(v,{modelValue:p.amount,"onUpdate:modelValue":F=>p.amount=F,name:`additionalCharges.${H}.amount`,label:t.$trans("student.fee.props.additional_charge_amount"),currency:"",onChange:G,error:e(g)[`additionalCharges.${H}.amount`],"onUpdate:error":F=>e(g)[`additionalCharges.${H}.amount`]=F},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])])])]),_:2},1024))),128)):y("",!0),c.showAdditionalDiscount?(l(!0),k(S,{key:1},Q(i.additionalDiscounts,(p,H)=>(l(),U(q,{class:"mt-4",key:p.uuid},{legend:s(()=>[b(d(t.$trans("student.fee.props.additional_discount")),1)]),default:s(()=>[f("div",Zt,[f("div",xt,[o(v,{modelValue:p.label,"onUpdate:modelValue":F=>p.label=F,name:`additionalDiscounts.${H}.label`,label:t.$trans("student.fee.props.additional_discount_label"),error:e(g)[`additionalDiscounts.${H}.label`],"onUpdate:error":F=>e(g)[`additionalDiscounts.${H}.label`]=F},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])]),f("div",Qt,[o(v,{modelValue:p.amount,"onUpdate:modelValue":F=>p.amount=F,name:`additionalDiscounts.${H}.amount`,label:t.$trans("student.fee.props.additional_discount_amount"),currency:"",onChange:G,error:e(g)[`additionalDiscounts.${H}.amount`],"onUpdate:error":F=>e(g)[`additionalDiscounts.${H}.amount`]=F},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])])])]),_:2},1024))),128)):y("",!0)],64)):y("",!0),f("div",Xt,[f("div",Yt,[o(v,{disabled:!0,modelValue:i.amount,"onUpdate:modelValue":a[12]||(a[12]=p=>i.amount=p),name:"amount",currency:"",label:t.$trans("student.fee.props.amount"),error:e(g).amount,"onUpdate:error":a[13]||(a[13]=p=>e(g).amount=p)},null,8,["modelValue","label","error"])]),f("div",ea,[o(x,{modelValue:i.ledger,"onUpdate:modelValue":a[14]||(a[14]=p=>i.ledger=p),name:"ledger",label:t.$trans("finance.ledger.ledger"),options:m.preRequisites.ledgers,"label-prop":"name","value-prop":"uuid",error:e(g).ledger,"onUpdate:error":a[15]||(a[15]=p=>e(g).ledger=p)},null,8,["modelValue","label","options","error"])]),f("div",ta,[o(x,{modelValue:c.selectedPaymentMethod,"onUpdate:modelValue":a[16]||(a[16]=p=>c.selectedPaymentMethod=p),name:"paymentMethod",label:t.$trans("finance.payment_method.payment_method"),options:m.preRequisites.paymentMethods,"object-prop":!0,"label-prop":"name","value-prop":"uuid",error:e(g).paymentMethod,"onUpdate:error":a[17]||(a[17]=p=>e(g).paymentMethod=p),onChange:N},null,8,["modelValue","label","options","error"])]),c.selectedPaymentMethod?(l(),U(E,{key:0,"selected-payment-method":c.selectedPaymentMethod,instrumentNumber:i.instrumentNumber,"onUpdate:instrumentNumber":a[18]||(a[18]=p=>i.instrumentNumber=p),instrumentDate:i.instrumentDate,"onUpdate:instrumentDate":a[19]||(a[19]=p=>i.instrumentDate=p),clearingDate:i.clearingDate,"onUpdate:clearingDate":a[20]||(a[20]=p=>i.clearingDate=p),bankDetail:i.bankDetail,"onUpdate:bankDetail":a[21]||(a[21]=p=>i.bankDetail=p),referenceNumber:i.referenceNumber,"onUpdate:referenceNumber":a[22]||(a[22]=p=>i.referenceNumber=p),formErrors:e(g),"onUpdate:formErrors":a[23]||(a[23]=p=>ue(g)?g.value=p:null)},null,8,["selected-payment-method","instrumentNumber","instrumentDate","clearingDate","bankDetail","referenceNumber","formErrors"])):y("",!0),f("div",aa,[o(r,{rows:1,modelValue:i.remarks,"onUpdate:modelValue":a[24]||(a[24]=p=>i.remarks=p),name:"remarks",label:t.$trans("student.payment.props.remarks"),error:e(g).remarks,"onUpdate:error":a[25]||(a[25]=p=>e(g).remarks=p)},null,8,["modelValue","label","error"])])])]),_:1},8,["uuid","form"])]),_:1},8,["show"])}}}),la={class:"flex justify-start"},oa={key:0,class:"flex justify-end p-4"},ra={name:"StudentFeeHeadList"},ia=Object.assign(ra,{props:{state:{type:Object,default(){return{}}}},emits:["setIsLoading","refresh"],setup(m,{emit:X}){const z=ae(),J=ne(),I=X,V=le("$trans"),n=[{key:"name",label:V("finance.fee_head.fee_head"),visibility:!0},{key:"amount",label:V("finance.transaction.props.amount"),visibility:!0,align:"right"},{key:"concession",label:V("finance.fee_concession.fee_concession"),visibility:!0,align:"right"},{key:"total",label:V("finance.fee.total"),visibility:!0,align:"right"},{key:"paid",label:V("finance.fee.paid"),visibility:!0,align:"right"},{key:"balance",label:V("finance.fee.balance"),visibility:!0,align:"right"},{key:"action",label:"",visibility:!0}],P=te(!1),g=K({isPaymentPreRequisiteSet:!1}),c=K({feeGroups:[],paymentMethods:[],ledgers:[]}),i=async()=>{I("setIsLoading",!0),await J.dispatch("student/payment/preRequisite",{uuid:z.params.uuid}).then(A=>{Object.assign(c,A),g.isPaymentPreRequisiteSet=!0,I("setIsLoading",!1)}).catch(A=>{I("setIsLoading",!1)})},N=async(A={})=>{g.isPaymentPreRequisiteSet||await i(),P.value=!0},w=()=>{P.value=!1},u=()=>{w(),I("refresh")};return(A,M)=>{const D=$("DataCell"),G=$("DataRow"),C=$("SimpleTable"),h=$("BaseButton");return l(),k(S,null,[o(C,{corner:"sharp",header:n},{default:s(()=>[(l(!0),k(S,null,Q(m.state.feeHeads,t=>(l(),U(G,{key:t.uuid,"text-color":t.isDeduction?"danger":""},{default:s(()=>[o(D,{name:"name"},{default:s(()=>[b(d(t.name),1)]),_:2},1024),o(D,{align:"right",name:"amount"},{default:s(()=>[b(d(t.amount.formatted),1)]),_:2},1024),o(D,{align:"right",name:"concession"},{default:s(()=>[b(d(t.concession.formatted),1)]),_:2},1024),o(D,{align:"right",name:"total"},{default:s(()=>[b(d(t.total.formatted),1)]),_:2},1024),o(D,{align:"right",name:"paid"},{default:s(()=>[b(d(t.paid.formatted),1)]),_:2},1024),o(D,{align:"right",name:"balance"},{default:s(()=>[b(d(t.balance.formatted),1)]),_:2},1024),o(D,{name:"action"})]),_:2},1032,["text-color"]))),128)),m.state.summary?(l(),U(G,{key:0,"is-heading":""},{default:s(()=>[o(D,{name:"name","is-heading":""},{default:s(()=>[f("div",la,[f("span",null,d(e(V)("finance.fee.total")),1)])]),_:1}),o(D,{align:"right",name:"amount","is-heading":""},{default:s(()=>{var t;return[b(d((t=m.state.summary.grandTotalAmount)==null?void 0:t.formatted),1)]}),_:1}),o(D,{align:"right",name:"concession","is-heading":""},{default:s(()=>{var t;return[b(d((t=m.state.summary.grandTotalConcession)==null?void 0:t.formatted),1)]}),_:1}),o(D,{align:"right",name:"total","is-heading":""},{default:s(()=>{var t;return[b(d((t=m.state.summary.grandTotal)==null?void 0:t.formatted),1)]}),_:1}),o(D,{align:"right",name:"paid","is-heading":""},{default:s(()=>{var t;return[b(d((t=m.state.summary.grandTotalPaid)==null?void 0:t.formatted),1)]}),_:1}),o(D,{align:"right",name:"balance","is-heading":""},{default:s(()=>{var t;return[b(d((t=m.state.summary.grandTotalBalance)==null?void 0:t.formatted),1)]}),_:1}),o(D,{name:"action"})]),_:1})):y("",!0)]),_:1}),e(Z)("fee:head-wise-payment")?(l(),k("div",oa,[o(h,{design:"primary",onClick:N},{default:s(()=>[b(d(e(V)("global.pay",{attribute:e(V)("student.fee.fee")})),1)]),_:1})])):y("",!0),o(sa,{visibility:P.value,"pre-requisites":c,"fee-heads":m.state.feeHeads,date:m.state.date,onClose:w,onCompleted:u},null,8,["visibility","pre-requisites","fee-heads","date"])],64)}}}),da={class:"flex flex-wrap gap-2"},ua=["onClick"],ma=["is-loading"],ca=["onClick"],pa={key:0},fa={key:1},ba={key:1,class:"text-sm"},ga={key:0,class:"pt-4 px-4 sm:px-6"},ya={name:"StudentShowFee"},_a=Object.assign(ya,{props:{student:{type:Object,default(){return{}}}},emits:["refresh"],setup(m,{emit:X}){const z=ae(),J=pe(),I=ne(),V=le("emitter"),n=le("$trans"),P=m,g=de(()=>!(!Z("fee:set")||u.fees.length)),c=de(()=>!Z("fee:set")||!u.fees.length||u.type=="head"?!1:!u.fees.some(t=>{var a,v;return((a=t.status)==null?void 0:a.value)==="paid"||((v=t.status)==null?void 0:v.value)==="partially_paid"})),i=de(()=>!(!Z("fee:set")||!u.fees.length)),N=te(!1),w=K({feeRecords:[],previousDues:[]}),u=K({type:"group",date:{},feeGroups:[],fees:[],transactions:[],feeHeads:{},summary:{}}),A=async()=>{await D()},M=t=>{u.type=t,D()},D=async()=>{var t;N.value=!0,await I.dispatch("student/fee/list",{uuid:z.params.uuid,date:((t=u.date)==null?void 0:t.value)||"",type:u.type}).then(a=>{u.date=a.date,u.fees=a.fees,u.type=="group"?(u.feeGroups=a.feeGroups,u.summary=a.summary,u.feeHeads=[],u.transactions=a.transactions):(u.feeHeads=a.feeHeads,u.summary=a.summary,u.feeGroups=[],u.transactions=[]),N.value=!1}).catch(a=>{N.value=!1})},G=async()=>{N.value=!0,await I.dispatch("student/fee/getStudentFees",{uuid:z.params.uuid}).then(t=>{w.feeRecords=t.feeRecords,w.previousDues=t.previousDues,N.value=!1}).catch(t=>{N.value=!1})},C=async()=>{await $e()&&(N.value=!0,await I.dispatch("student/fee/reset",{uuid:z.params.uuid}).then(t=>{u.feeGroups=[],u.fees=[],u.feeHeads={},u.summary={},V.emit("studentUpdated"),N.value=!1}).catch(t=>{N.value=!1}))},h=()=>{window.open(`/app/students/${z.params.uuid}/fee/export?action=print`)};return fe(async()=>{u.date.value=new Date().toLocaleDateString("en-CA"),Z("fee:change-payment-date")||await D(),await G()}),ve(()=>z.params.uuid,(t,a)=>{t!=null&&t!=a&&D()}),(t,a)=>{const v=$("BaseButton"),W=$("DropdownItem"),x=$("PageHeaderAction"),O=$("PageHeader"),ee=$("BaseAlert"),Y=$("ParentTransition"),q=$("DatePicker"),E=$("BaseCard");return l(),k(S,null,[m.student.uuid?(l(),U(O,{key:0,title:e(n)(e(z).meta.label),navs:[{label:e(n)("student.student"),path:"Student"},{label:m.student.contact.name,path:{name:"StudentShow",params:{uuid:m.student.uuid}}}]},{default:s(()=>[o(x,null,ke({default:s(()=>[g.value&&!m.student.hasFeeStructureSet?(l(),U(v,{key:0,design:"white",onClick:a[0]||(a[0]=r=>e(J).push({name:"StudentSetFee",params:{uuid:P.student.uuid}}))},{default:s(()=>[b(d(e(n)("global.set",{attribute:e(n)("student.fee.fee")})),1)]),_:1})):y("",!0),u.fees.length>0?(l(),k(S,{key:1},[u.type=="group"?(l(),U(v,{key:0,design:"white",onClick:a[1]||(a[1]=r=>M("head"))},{default:s(()=>[b(d(e(n)("student.fee.head_wise")),1)]),_:1})):y("",!0),u.type=="head"?(l(),U(v,{key:1,design:"white",onClick:a[2]||(a[2]=r=>M("group"))},{default:s(()=>[b(d(e(n)("student.fee.group_wise")),1)]),_:1})):y("",!0)],64)):y("",!0)]),_:2},[c.value||i.value?{name:"dropdown",fn:s(()=>[c.value?(l(),U(W,{key:0,icon:"fas fa-times",onClick:C},{default:s(()=>[b(d(e(n)("global.reset",{attribute:e(n)("student.fee.fee")})),1)]),_:1})):y("",!0),i.value?(l(),U(W,{key:1,icon:"fas fa-pencil-alt",onClick:a[3]||(a[3]=r=>e(J).push({name:"StudentEditFee",params:{uuid:P.student.uuid}}))},{default:s(()=>[b(d(e(n)("global.edit",{attribute:e(n)("student.fee.fee")})),1)]),_:1})):y("",!0),i.value?(l(),U(W,{key:2,icon:"fas fa-pen-to-square",onClick:a[4]||(a[4]=r=>e(J).push({name:"StudentCustomFee",params:{uuid:P.student.uuid}}))},{default:s(()=>[b(d(e(n)("finance.fee_head.custom_fee")),1)]),_:1})):y("",!0),o(W,{icon:"fas fa-print",onClick:h},{default:s(()=>[b(d(e(n)("global.print",{attribute:e(n)("student.fee.fee")})),1)]),_:1})]),key:"0"}:void 0]),1024)]),_:1},8,["title","navs"])):y("",!0),o(Y,{appear:"",visibility:!0},{default:s(()=>[f("div",da,[(l(!0),k(S,null,Q(w.feeRecords,r=>(l(),k("span",{onClick:B=>e(J).push({name:"StudentShowFee",params:{uuid:r.uuid}}),class:"cursor-pointer px-4 py-2 bg-primary rounded-xl text-white text-xs"},d(r.course+" "+r.batch)+" ("+d(r.period)+") ",9,ua))),256))]),w.previousDues.length>0?(l(),k("div",{key:0,class:"mt-4","is-loading":N.value},[(l(!0),k(S,null,Q(w.previousDues,r=>(l(),k("div",{class:"cursor-pointer",onClick:B=>e(J).push({name:"StudentShowFee",params:{uuid:r.uuid}})},[o(ee,{size:"xs",design:"error"},{default:s(()=>[b(d(e(n)("student.fee.previous_due_info",{period:r.period,amount:r.balance.formatted})),1)]),_:2},1024)],8,ca))),256))],8,ma)):y("",!0)]),_:1}),o(Y,{appear:"",visibility:!0},{default:s(()=>[m.student.uuid?(l(),U(E,{key:0,"no-padding":"","no-content-padding":"","bottom-content-padding":"","is-loading":N.value},{title:s(()=>[u.type=="group"?(l(),k("span",pa,d(e(n)("student.fee.group_wise")),1)):(l(),k("span",fa,d(e(n)("student.fee.head_wise")),1))]),action:s(()=>[e(Z)("fee:change-payment-date")?(l(),U(q,{key:0,slim:"",modelValue:u.date.value,"onUpdate:modelValue":a[5]||(a[5]=r=>u.date.value=r),name:"date","no-clear":"",onChange:A},null,8,["modelValue"])):(l(),k("span",ba,d(u.date.formatted),1))]),default:s(()=>[u.fees.length===0?(l(),k("div",ga,[o(ee,{size:"xs",design:"error"},{default:s(()=>[b(d(e(n)("student.fee.set_fee_info")),1)]),_:1})])):(l(),k(S,{key:1},[u.type=="group"?(l(),U(Rt,{key:0,state:u,onSetIsLoading:a[6]||(a[6]=r=>N.value=r),onRefresh:D},null,8,["state"])):y("",!0),u.type=="head"?(l(),U(ia,{key:1,state:u,onSetIsLoading:a[7]||(a[7]=r=>N.value=r),onRefresh:D},null,8,["state"])):y("",!0)],64))]),_:1},8,["is-loading"])):y("",!0)]),_:1})],64)}}});export{_a as default};
