import{f as I,j as X,m as q,G as Y,n as E,r as u,o as p,q as g,w as e,d as c,e as t,s as d,t as r,b as _,y as Z,l as A,a as C,u as S,F as j,v as z,h as x,i as ee}from"./app-DCfJDSeM.js";const te={class:"grid grid-cols-3 gap-6"},ae={class:"col-span-3 sm:col-span-1"},ne={class:"col-span-3 sm:col-span-1"},se={class:"col-span-3 sm:col-span-1"},le={class:"col-span-3 sm:col-span-1"},oe={class:"col-span-3 sm:col-span-1"},re={class:"col-span-3 sm:col-span-1"},de={class:"col-span-3 sm:col-span-1"},ie={class:"col-span-3 sm:col-span-1"},ue={class:"col-span-3 sm:col-span-1"},me={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide"],setup(M,{emit:k}){const f=I();X("moment");const R=k,B=M,F={codeNumber:"",voucherNumber:"",name:"",batches:[],startDate:"",endDate:"",period:"",ledgers:[],paymentMethods:[],status:""},l=q({...F});Y(B.initUrl);const m=q({isLoaded:!f.query.batches}),b=q({paymentMethods:B.preRequisites.paymentMethods});return E(async()=>{m.batches=f.query.batches?f.query.batches.split(","):[],m.ledgers=f.query.ledgers?f.query.ledgers.split(","):[],m.paymentMethods=f.query.paymentMethods?f.query.paymentMethods.split(","):[],m.isLoaded=!0}),(i,a)=>{const N=u("BaseInput"),v=u("BaseSelectSearch"),T=u("DatePicker"),o=u("BaseSelect"),$=u("FilterForm");return p(),g($,{"init-form":F,multiple:["batches","ledgers","paymentMethods"],form:l,onHide:a[10]||(a[10]=n=>R("hide"))},{default:e(()=>[c("div",te,[c("div",ae,[t(N,{type:"text",modelValue:l.codeNumber,"onUpdate:modelValue":a[0]||(a[0]=n=>l.codeNumber=n),name:"codeNumber",label:i.$trans("student.admission.props.code_number")},null,8,["modelValue","label"])]),c("div",ne,[t(N,{type:"text",modelValue:l.voucherNumber,"onUpdate:modelValue":a[1]||(a[1]=n=>l.voucherNumber=n),name:"voucherNumber",label:i.$trans("finance.transaction.props.code_number")},null,8,["modelValue","label"])]),c("div",se,[t(N,{type:"text",modelValue:l.name,"onUpdate:modelValue":a[2]||(a[2]=n=>l.name=n),name:"name",label:i.$trans("contact.props.name")},null,8,["modelValue","label"])]),c("div",le,[m.isLoaded?(p(),g(v,{key:0,multiple:"",name:"batches",label:i.$trans("global.select",{attribute:i.$trans("academic.batch.batch")}),modelValue:l.batches,"onUpdate:modelValue":a[3]||(a[3]=n=>l.batches=n),"value-prop":"uuid","init-search":m.batches,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:e(n=>[d(r(n.value.course.name)+" "+r(n.value.name),1)]),listOption:e(n=>[d(r(n.option.course.nameWithTerm)+" "+r(n.option.name),1)]),_:1},8,["label","modelValue","init-search"])):_("",!0)]),c("div",oe,[t(T,{start:l.startDate,"onUpdate:start":a[4]||(a[4]=n=>l.startDate=n),end:l.endDate,"onUpdate:end":a[5]||(a[5]=n=>l.endDate=n),name:"dateBetween",as:"range",label:i.$trans("general.date_between")},null,8,["start","end","label"])]),c("div",re,[t(o,{name:"period",label:i.$trans("global.select",{attribute:i.$trans("academic.period.period")}),modelValue:l.period,"onUpdate:modelValue":a[6]||(a[6]=n=>l.period=n),"label-prop":"name","value-prop":"uuid",options:M.preRequisites.periods},null,8,["label","modelValue","options"])]),c("div",de,[m.isLoaded?(p(),g(v,{key:0,multiple:"",name:"ledgers",label:i.$trans("global.select",{attribute:i.$trans("finance.ledger.ledger")}),modelValue:l.ledgers,"onUpdate:modelValue":a[7]||(a[7]=n=>l.ledgers=n),"label-props":"name","value-prop":"uuid","init-search":m.ledgers,"search-action":"finance/ledger/list"},null,8,["label","modelValue","init-search"])):_("",!0)]),c("div",ie,[t(o,{multiple:"",modelValue:l.paymentMethods,"onUpdate:modelValue":a[8]||(a[8]=n=>l.paymentMethods=n),name:"paymentMethods",label:i.$trans("finance.payment_method.payment_method"),"label-prop":"name","value-prop":"uuid",options:b.paymentMethods},null,8,["modelValue","label","options"])]),c("div",ue,[t(o,{name:"status",label:i.$trans("global.select",{attribute:i.$trans("finance.transaction.props.status")}),modelValue:l.status,"onUpdate:modelValue":a[9]||(a[9]=n=>l.status=n),options:M.preRequisites.statuses},null,8,["label","modelValue","options"])])])]),_:1},8,["form"])}}},pe={name:"FinanceReportFeePayment"},fe=Object.assign(pe,{setup(M){const k=I(),f=x(),R=ee();let B=["filter"],F=[];Z("finance:export")&&(F=["print","pdf","excel"]);const l="finance/report/",m=A(!1),b=A(!1),i=q({periods:[],ledgers:[],paymentMethods:[]}),a=q({headers:[],data:[],meta:{total:0}}),N=async()=>{b.value=!0,await R.dispatch(l+"preRequisite",{name:"fee-payment",params:k.query}).then(o=>{b.value=!1,Object.assign(i,o)}).catch(o=>{b.value=!1})},v=async()=>{b.value=!0,await R.dispatch(l+"fetchReport",{name:"fee-payment",params:k.query}).then(o=>{b.value=!1,Object.assign(a,o)}).catch(o=>{b.value=!1})},T=o=>{window.open(`/app/students/${o.studentUuid}/transactions/${o.uuid}/export?action=print`)};return E(async()=>{await N(),await v()}),(o,$)=>{const n=u("PageHeaderAction"),G=u("PageHeader"),O=u("ParentTransition"),V=u("TextMuted"),D=u("BaseBadge"),h=u("DataCell"),P=u("FloatingMenuItem"),W=u("FloatingMenu"),J=u("DataRow"),K=u("DataTable"),Q=u("BaseCard");return p(),C(j,null,[t(G,{title:o.$trans(S(k).meta.label),navs:[{label:o.$trans("finance.finance"),path:"Finance"},{label:o.$trans("finance.report.report"),path:"FinanceReport"}]},{default:e(()=>[t(n,{url:"finance/reports/fee-payment/",name:"FinanceReportFeePayment",title:o.$trans("finance.report.fee_payment.fee_payment"),actions:S(B),"dropdown-actions":S(F),headers:a.headers,onToggleFilter:$[0]||($[0]=s=>m.value=!m.value)},null,8,["title","actions","dropdown-actions","headers"])]),_:1},8,["title","navs"]),t(O,{appear:"",visibility:m.value},{default:e(()=>[t(me,{onAfterFilter:v,"init-url":l,"pre-requisites":i,onHide:$[1]||($[1]=s=>m.value=!1)},null,8,["pre-requisites"])]),_:1},8,["visibility"]),t(O,{appear:"",visibility:!0},{default:e(()=>[t(Q,{"no-padding":"","no-content-padding":"","is-loading":b.value},{default:e(()=>[t(K,{header:a.headers,footer:a.footers,meta:a.meta,module:"finance.report.fee_payment",onRefresh:v},{default:e(()=>[(p(!0),C(j,null,z(a.data,s=>(p(),g(J,{key:s.uuid},{default:e(()=>[t(h,{name:"voucherNumber"},{default:e(()=>[d(r(s.voucherNumber)+" ",1),s.isOnline?(p(),g(V,{key:0,block:""},{default:e(()=>[d(r(s.referenceNumber),1)]),_:2},1024)):_("",!0),s.isRejected?(p(),g(D,{key:1,design:"warning",size:"sm"},{default:e(()=>[d(r(o.$trans("general.rejected")),1)]),_:1})):_("",!0),s.isCancelled?(p(),g(D,{key:2,design:"danger",size:"sm"},{default:e(()=>[d(r(o.$trans("general.cancelled")),1)]),_:1})):_("",!0),s.isOnline&&!s.isCompleted?(p(),g(D,{key:3,design:"danger",size:"sm"},{default:e(()=>[d(r(o.$trans("general.failed")),1)]),_:1})):_("",!0)]),_:2},1024),t(h,{name:"name"},{default:e(()=>[d(r(s.name)+" ",1),t(V,{block:""},{default:e(()=>[d(r(s.rollNumber||s.codeNumber),1)]),_:2},1024),t(D,{design:"primary",size:"sm"},{default:e(()=>[d(r(s.feeType),1)]),_:2},1024)]),_:2},1024),t(h,{name:"fatherName"},{default:e(()=>[d(r(s.fatherName)+" ",1),t(V,{block:""},{default:e(()=>[d(r(s.contactNumber),1)]),_:2},1024)]),_:2},1024),t(h,{name:"course"},{default:e(()=>[d(r(s.courseName)+" ",1),t(V,{block:""},{default:e(()=>[d(r(s.batchName),1)]),_:2},1024)]),_:2},1024),t(h,{name:"amount"},{default:e(()=>[d(r(s.amount.formatted),1)]),_:2},1024),t(h,{name:"date"},{default:e(()=>[d(r(s.date.formatted),1)]),_:2},1024),t(h,{name:"ledger"},{default:e(()=>{var y,w,H,L;return[d(r((w=(y=s.payment)==null?void 0:y.ledger)==null?void 0:w.name)+" ",1),t(V,{block:""},{default:e(()=>{var U;return[d(r((U=s.payment)==null?void 0:U.methodName),1)]}),_:2},1024),(L=(H=s.payment)==null?void 0:H.summary)!=null&&L.length?(p(),g(V,{key:0,block:""},{default:e(()=>[(p(!0),C(j,null,z(s.payment.summary,U=>(p(),C("div",null,r(U),1))),256))]),_:2},1024)):_("",!0)]}),_:2},1024),t(h,{name:"user"},{default:e(()=>{var y,w;return[d(r(((w=(y=s.user)==null?void 0:y.profile)==null?void 0:w.name)||"-"),1)]}),_:2},1024),t(h,{name:"action"},{default:e(()=>[t(W,null,{default:e(()=>[t(P,{icon:"fas fa-print",onClick:y=>T(s)},{default:e(()=>[d(r(o.$trans("global.print",{attribute:o.$trans("student.fee.receipt")})),1)]),_:2},1032,["onClick"]),t(P,{icon:"fas fa-arrow-circle-right",onClick:y=>S(f).push({name:"StudentShowFee",params:{uuid:s.studentUuid}})},{default:e(()=>[d(r(o.$trans("global.show",{attribute:o.$trans("student.fee.fee")})),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["header","footer","meta"])]),_:1},8,["is-loading"])]),_:1})],64)}}});export{fe as default};
