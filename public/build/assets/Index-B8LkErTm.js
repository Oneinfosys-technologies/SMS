import{f as H,j as K,m as q,G as Q,n as L,r as d,o as p,q as y,w as t,d as h,e as a,s as l,t as s,b as v,y as X,l as M,a as S,u as U,F as j,v as Y,h as Z,i as x}from"./app-DCfJDSeM.js";const ee={class:"grid grid-cols-3 gap-6"},te={class:"col-span-3 sm:col-span-1"},ae={class:"col-span-3 sm:col-span-1"},ne={class:"col-span-3 sm:col-span-1"},se={class:"col-span-3 sm:col-span-1"},oe={class:"col-span-3 sm:col-span-1"},le={class:"col-span-3 sm:col-span-1"},re={__name:"Filter",props:{initUrl:{type:String,default:""},preRequisites:{type:Object,default(){return{}}}},emits:["hide"],setup(V,{emit:$}){const F=H();K("moment");const w=$,B=V,C={referenceNumber:"",name:"",batches:[],startDate:"",endDate:"",period:"",status:""},u=q({...C});Q(B.initUrl);const f=q({isLoaded:!F.query.batches});return L(async()=>{f.batches=F.query.batches?F.query.batches.split(","):[],f.isLoaded=!0}),(r,i)=>{const _=d("BaseInput"),A=d("BaseSelectSearch"),k=d("DatePicker"),R=d("BaseSelect"),O=d("FilterForm");return p(),y(O,{"init-form":C,multiple:["batches"],form:u,onHide:i[7]||(i[7]=o=>w("hide"))},{default:t(()=>[h("div",ee,[h("div",te,[a(_,{type:"text",modelValue:u.referenceNumber,"onUpdate:modelValue":i[0]||(i[0]=o=>u.referenceNumber=o),name:"referenceNumber",label:r.$trans("finance.transaction.props.reference_number")},null,8,["modelValue","label"])]),h("div",ae,[a(_,{type:"text",modelValue:u.name,"onUpdate:modelValue":i[1]||(i[1]=o=>u.name=o),name:"name",label:r.$trans("contact.props.name")},null,8,["modelValue","label"])]),h("div",ne,[f.isLoaded?(p(),y(A,{key:0,multiple:"",name:"batches",label:r.$trans("global.select",{attribute:r.$trans("academic.batch.batch")}),modelValue:u.batches,"onUpdate:modelValue":i[2]||(i[2]=o=>u.batches=o),"value-prop":"uuid","init-search":f.batches,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:t(o=>[l(s(o.value.course.name)+" "+s(o.value.name),1)]),listOption:t(o=>[l(s(o.option.course.nameWithTerm)+" "+s(o.option.name),1)]),_:1},8,["label","modelValue","init-search"])):v("",!0)]),h("div",se,[a(k,{start:u.startDate,"onUpdate:start":i[3]||(i[3]=o=>u.startDate=o),end:u.endDate,"onUpdate:end":i[4]||(i[4]=o=>u.endDate=o),name:"dateBetween",as:"range",label:r.$trans("general.date_between")},null,8,["start","end","label"])]),h("div",oe,[a(R,{name:"period",label:r.$trans("global.select",{attribute:r.$trans("academic.period.period")}),modelValue:u.period,"onUpdate:modelValue":i[5]||(i[5]=o=>u.period=o),"label-prop":"name","value-prop":"uuid",options:V.preRequisites.periods},null,8,["label","modelValue","options"])]),h("div",le,[a(R,{name:"status",label:r.$trans("global.select",{attribute:r.$trans("finance.transaction.props.status")}),modelValue:u.status,"onUpdate:modelValue":i[6]||(i[6]=o=>u.status=o),options:V.preRequisites.statuses},null,8,["label","modelValue","options"])])])]),_:1},8,["form"])}}},ue={key:0},ie={key:2,class:"text-danger text-xs"},de={name:"FinanceReportOnlineFeePayment"},pe=Object.assign(de,{setup(V){const $=H(),F=Z(),w=x();let B=["filter"],C=[];X("finance:export")&&(C=["print","pdf","excel"]);const u="finance/report/",f=M(!1),r=M(!1),i=q({periods:[],statuses:[]}),_=q({headers:[],data:[],meta:{total:0}}),A=async()=>{r.value=!0,await w.dispatch(u+"preRequisite",{name:"online-fee-payment",params:$.query}).then(n=>{r.value=!1,Object.assign(i,n)}).catch(n=>{r.value=!1})},k=async()=>{r.value=!0,await w.dispatch(u+"fetchReport",{name:"online-fee-payment",params:$.query}).then(n=>{r.value=!1,Object.assign(_,n)}).catch(n=>{r.value=!1})},R=async n=>{r.value=!0,await w.dispatch("student/payment/updatePaymentStatus",{uuid:n.studentUuid,moduleUuid:n.uuid}).then(m=>{r.value=!1,k()}).catch(m=>{r.value=!1})},O=n=>{window.open(n.statusCheckUrl)},o=n=>{window.open(`/app/students/${n.studentUuid}/transactions/${n.uuid}/export?action=print`)};return L(async()=>{await A(),await k()}),(n,m)=>{const I=d("PageHeaderAction"),E=d("PageHeader"),P=d("ParentTransition"),g=d("TextMuted"),b=d("DataCell"),D=d("FloatingMenuItem"),G=d("FloatingMenu"),W=d("DataRow"),z=d("DataTable"),J=d("BaseCard");return p(),S(j,null,[a(E,{title:n.$trans(U($).meta.label),navs:[{label:n.$trans("finance.finance"),path:"Finance"},{label:n.$trans("finance.report.report"),path:"FinanceReport"}]},{default:t(()=>[a(I,{url:"finance/reports/online-fee-payment/",name:"FinanceReportOnlineFeePayment",title:n.$trans("finance.report.online_fee_payment.online_fee_payment"),actions:U(B),"dropdown-actions":U(C),headers:_.headers,onToggleFilter:m[0]||(m[0]=e=>f.value=!f.value)},null,8,["title","actions","dropdown-actions","headers"])]),_:1},8,["title","navs"]),a(P,{appear:"",visibility:f.value},{default:t(()=>[a(re,{onAfterFilter:k,"init-url":u,"pre-requisites":i,onHide:m[1]||(m[1]=e=>f.value=!1)},null,8,["pre-requisites"])]),_:1},8,["visibility"]),a(P,{appear:"",visibility:!0},{default:t(()=>[a(J,{"no-padding":"","no-content-padding":"","is-loading":r.value},{default:t(()=>[a(z,{header:_.headers,meta:_.meta,module:"finance.report.online_fee_payment",onRefresh:k},{default:t(()=>[(p(!0),S(j,null,Y(_.data,e=>(p(),y(W,{key:e.uuid},{default:t(()=>[a(b,{name:"voucherNumber"},{default:t(()=>[l(s(e.voucherNumber)+" ",1),e.processedAt.value?(p(),S("span",ue,m[2]||(m[2]=[h("i",{class:"far fa-lg fa-check-circle text-success"},null,-1)]))):v("",!0),e.isOnline?(p(),y(g,{key:1,block:""},{default:t(()=>[l(s(e.referenceNumber),1)]),_:2},1024)):v("",!0),!e.processedAt.value&&e.errorCode?(p(),S("span",ie,s(e.errorCode),1)):v("",!0)]),_:2},1024),a(b,{name:"name"},{default:t(()=>[l(s(e.name)+" ",1),a(g,{block:""},{default:t(()=>[l(s(e.rollNumber||e.codeNumber),1)]),_:2},1024)]),_:2},1024),a(b,{name:"fatherName"},{default:t(()=>[l(s(e.fatherName)+" ",1),a(g,{block:""},{default:t(()=>[l(s(e.contactNumber),1)]),_:2},1024)]),_:2},1024),a(b,{name:"course"},{default:t(()=>[l(s(e.courseName)+" ",1),a(g,{block:""},{default:t(()=>[l(s(e.batchName),1)]),_:2},1024)]),_:2},1024),a(b,{name:"amount"},{default:t(()=>[l(s(e.amount.formatted),1)]),_:2},1024),a(b,{name:"date"},{default:t(()=>[l(s(e.date.formatted)+" ",1),a(g,{block:""},{default:t(()=>[l(s(e.createdAt.formatted),1)]),_:2},1024),e.processedAt.value?(p(),y(g,{key:0,block:"",class:"text-success"},{default:t(()=>{var c;return[l(s((c=e.processedAt)==null?void 0:c.formatted),1)]}),_:2},1024)):v("",!0)]),_:2},1024),a(b,{name:"ledger"},{default:t(()=>{var c,N;return[l(s((N=(c=e.payment)==null?void 0:c.ledger)==null?void 0:N.name)+" ",1),a(g,{block:""},{default:t(()=>{var T;return[l(s((T=e.payment)==null?void 0:T.methodName),1)]}),_:2},1024)]}),_:2},1024),a(b,{name:"user"},{default:t(()=>{var c,N;return[l(s(((N=(c=e.user)==null?void 0:c.profile)==null?void 0:N.name)||"-"),1)]}),_:2},1024),a(b,{name:"action"},{default:t(()=>[a(G,null,{default:t(()=>[e.processedAt.value?(p(),y(D,{key:0,icon:"fas fa-print",onClick:c=>o(e)},{default:t(()=>[l(s(n.$trans("global.print",{attribute:n.$trans("student.fee.receipt")})),1)]),_:2},1032,["onClick"])):v("",!0),e.processedAt.value?v("",!0):(p(),y(D,{key:1,icon:"fas fa-sync",onClick:c=>R(e)},{default:t(()=>[l(s(n.$trans("global.refresh",{attribute:n.$trans("finance.transaction.props.status")})),1)]),_:2},1032,["onClick"])),a(D,{icon:"fas fa-arrow-circle-right",onClick:c=>U(F).push({name:"StudentShowFee",params:{uuid:e.studentUuid}})},{default:t(()=>[l(s(n.$trans("global.show",{attribute:n.$trans("student.fee.fee")})),1)]),_:2},1032,["onClick"]),e.hasStatusCheck?(p(),y(D,{key:2,icon:"fas fa-print",onClick:c=>O(e)},{default:t(()=>m[3]||(m[3]=[l("Check Status")])),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["header","meta"])]),_:1},8,["is-loading"])]),_:1})],64)}}});export{pe as default};
