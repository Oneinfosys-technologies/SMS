import{f as X,i as K,j as Y,B as Z,l as Q,m as S,r as k,o,a as i,e as l,w as s,s as c,t as n,u,q as B,F as _,v as F,d,b as m,g as z,G as ee,n as te,h as ae,I as se}from"./app-DCfJDSeM.js";import{_ as ne}from"./OnlinePaymentForm-C7xaEMRA.js";import"./Billdesk-rvYHEUh7.js";const oe={class:"flex justify-start"},le={key:0},re={class:"text-right sm:text-left"},ie={key:0},ue={key:1,class:"text-xs"},de={class:"text-right sm:text-left"},ce={class:"ml-2"},me={key:1},pe={key:2,class:"text-xs"},fe={key:0,class:"flex justify-between"},ge={key:0,class:"line-through mr-2"},ye={key:0,class:"flex justify-between"},be={key:0,class:"flex justify-between"},he={class:"truncate"},_e={key:0,class:"flex justify-between"},ve={class:"truncate"},ke={class:"flex justify-start"},$e={name:"GuestPaymentFeeDetail"},Ce=Object.assign($e,{props:{state:{type:Object,default(){return{}}},paymentGateways:{type:Array,default(){return[]}}},emits:["setIsLoading","refresh"],setup(C,{emit:E}){X(),K();const N=E,j=C,p=Y("$trans"),{screenSize:P}=Z(),g=[{key:"title",label:p("finance.fee_structure.props.title"),visibility:!0},{key:"dueDate",label:p("finance.fee_structure.props.due_date"),visibility:!0},{key:"fee",label:p("student.fee.fee"),visibility:!0},{key:"total",label:p("finance.fee.total"),visibility:!0,align:"right"},{key:"paid",label:p("finance.fee.paid"),visibility:!0,align:"right"},{key:"balance",label:p("finance.fee.balance"),visibility:!0,align:"right"},{key:"action",label:"",visibility:!0}],O=[{key:"codeNumber",label:p("finance.transaction.props.code_number"),visibility:!0},{key:"date",label:p("finance.transaction.props.date"),visibility:!0},{key:"amount",label:p("finance.transaction.props.amount"),visibility:!0}],v=V=>j.state.fees.filter(D=>D.installment.group.uuid==V.uuid),$=Q(!1),b=S({feeGroup:{},fee:{},transaction:{}}),r=V=>{let D=j.state.transactions.filter(t=>t.records.filter(h=>h.additionalCharges.length>0).length>0),a=[];return D.filter(t=>!t.isCancelled&&!t.isRejected).forEach(t=>{t.records.forEach(h=>{h.studentFeeUuid==V.uuid&&a.push(...h.additionalCharges)})}),a},H=V=>{let D=j.state.transactions.filter(t=>t.records.filter(h=>h.additionalDiscounts.length>0).length>0),a=[];return D.filter(t=>!t.isCancelled&&!t.isRejected).forEach(t=>{t.records.forEach(h=>{h.studentFeeUuid==V.uuid&&a.push(...h.additionalDiscounts)})}),a},G=async(V={})=>{b.feeGroup={},b.fee=V,$.value=!0},I=async(V={})=>{b.fee={},b.feeGroup=V,$.value=!0},L=()=>{$.value=!1,b.fee={},b.feeGroup={}},q=()=>{b.fee={},b.feeGroup={},L(),N("refresh")};return(V,D)=>{const a=k("DataCell"),t=k("BaseButton"),h=k("FloatingMenuItem"),A=k("FloatingMenu"),w=k("DataRow"),x=k("BaseBadge"),R=k("SimpleTable"),T=k("BaseFieldset"),M=k("TextMuted");return o(),i(_,null,[l(T,{class:"mt-4","no-padding":""},{legend:s(()=>[c(n(u(p)("student.payment.online")),1)]),default:s(()=>[C.state.fees.length>0?(o(),B(R,{key:0,corner:"sharp",header:g},{default:s(()=>[(o(!0),i(_,null,F(C.state.feeGroups,f=>(o(),i(_,null,[l(w,{"is-heading":""},{default:s(()=>[l(a,{name:"title",colspan:3,"is-heading":""},{default:s(()=>[d("div",oe,[d("span",null,[f.status.value=="paid"?(o(),i("span",le,D[0]||(D[0]=[d("i",{class:"fas fa-check-circle text-success mr-1"},null,-1)]))):m("",!0),c(" "+n(f.name),1)])])]),_:2},1024),l(a,{name:"total",align:"right","is-heading":""},{default:s(()=>[c(n(f.total.formatted),1)]),_:2},1024),l(a,{name:"paid",align:"right","is-heading":""},{default:s(()=>[c(n(f.paid.formatted),1)]),_:2},1024),l(a,{name:"balance",align:"right","is-heading":""},{default:s(()=>[c(n(f.balance.formatted),1)]),_:2},1024),l(a,{streched:""},{default:s(()=>[u(P).small&&f.balance.value>0?(o(),B(t,{key:0,block:"",onClick:e=>I(f)},{default:s(()=>[c(n(u(p)("global.pay",{attribute:u(p)("finance.fee_group.fee_group")})),1)]),_:2},1032,["onClick"])):m("",!0),!u(P).small&&f.balance.value>0?(o(),B(A,{key:1,slim:""},{default:s(()=>[l(h,{onClick:e=>I(f)},{default:s(()=>[c(n(u(p)("finance.payment.online")),1)]),_:2},1032,["onClick"])]),_:2},1024)):m("",!0)]),_:2},1024)]),_:2},1024),(o(!0),i(_,null,F(v(f),(e,U)=>(o(),B(w,{key:e.uuid},{default:s(()=>[l(a,{name:"title"},{default:s(()=>[d("div",re,[e.status.value=="paid"?(o(),i("span",ie,D[1]||(D[1]=[d("i",{class:"fas fa-check-circle text-success mr-1"},null,-1)]))):m("",!0),c(" "+n(e.installment.title)+" ",1),e.concession?(o(),i("p",ue,n(e.concession.name),1)):m("",!0)])]),_:2},1024),l(a,{name:"dueDate"},{default:s(()=>[d("div",de,[e.overdue?(o(),B(x,{key:0,design:"error"},{default:s(()=>[c(n(e.dueDate.formatted)+" ",1),d("span",ce,"("+n(e.overdue+" "+u(p)("list.durations.day"))+")",1)]),_:2},1024)):m("",!0),e.overdue===0?(o(),i("p",me,n(e.dueDate.formatted),1)):m("",!0),e.lateFeeApplicable?(o(),i("p",pe,n(u(p)("finance.fee_structure.props.late_fee"))+" "+n(e.lateFee.formatted),1)):m("",!0)])]),_:2},1024),l(a,{name:"fee",streched:"",table:""},{default:s(()=>[(o(!0),i(_,null,F(e.records,y=>{var W,J;return o(),i(_,null,[y.amount.value>0?(o(),i("div",fe,[c(n(((W=y.head)==null?void 0:W.name)||((J=y.defaultFeeHead)==null?void 0:J.label)||"-")+" ",1),d("div",null,[y.concession.value>0?(o(),i("span",ge,n(y.amount.formatted),1)):m("",!0),d("span",null,n(y.amountWithConcession.formatted),1)])])):m("",!0)],64)}),256)),e.lateFee.amount.value>0?(o(),i("div",ye,[c(n(u(p)("finance.fee_structure.late_fee"))+" ",1),d("div",null,[d("span",null,n(e.lateFee.amount.formatted),1)])])):m("",!0),(o(!0),i(_,null,F(r(e),y=>(o(),i(_,null,[y.amount.value>0?(o(),i("div",be,[d("span",he,n(y.label),1),d("div",null,[d("span",null,n(y.amount.formatted),1)])])):m("",!0)],64))),256)),(o(!0),i(_,null,F(H(e),y=>(o(),i(_,null,[y.amount.value>0?(o(),i("div",_e,[d("span",ve,n(y.label),1),d("div",null,[d("span",null,"(-)"+n(y.amount.formatted),1)])])):m("",!0)],64))),256))]),_:2},1024),l(a,{align:"right",name:"total"},{default:s(()=>[c(n(e.total.formatted),1)]),_:2},1024),l(a,{align:"right",name:"paid"},{default:s(()=>[c(n(e.paid.formatted),1)]),_:2},1024),l(a,{align:"right",name:"balance"},{default:s(()=>[c(n(e.balance.formatted),1)]),_:2},1024),l(a,{name:"action",streched:""},{default:s(()=>[u(P).small&&e.balance.value>0?(o(),B(t,{key:0,block:"",onClick:y=>G(e)},{default:s(()=>[c(n(u(p)("finance.payment.online")),1)]),_:2},1032,["onClick"])):m("",!0),!u(P).small&&e.balance.value>0?(o(),B(A,{key:1},{default:s(()=>[l(h,{icon:"fas fa-credit-card",onClick:y=>G(e)},{default:s(()=>[c(n(u(p)("finance.payment.online")),1)]),_:2},1032,["onClick"])]),_:2},1024)):m("",!0)]),_:2},1024)]),_:2},1024))),128))],64))),256)),C.state.summary?(o(),B(w,{key:0,"is-heading":""},{default:s(()=>[l(a,{name:"title",colspan:3,"is-heading":""},{default:s(()=>[d("div",ke,[d("span",null,n(u(p)("global.grand",{attribute:u(p)("finance.fee.total")})),1)])]),_:1}),l(a,{name:"total",align:"right","is-heading":""},{default:s(()=>{var f;return[c(n((f=C.state.summary.grandTotal)==null?void 0:f.formatted),1)]}),_:1}),l(a,{name:"paid",align:"right","is-heading":""},{default:s(()=>{var f;return[c(n((f=C.state.summary.grandTotalPaid)==null?void 0:f.formatted),1)]}),_:1}),l(a,{name:"balance",align:"right","is-heading":""},{default:s(()=>{var f;return[c(n((f=C.state.summary.grandTotalBalance)==null?void 0:f.formatted),1)]}),_:1}),l(a)]),_:1})):m("",!0)]),_:1})):m("",!0)]),_:1}),C.state.transactions.length>0?(o(),B(T,{key:0,class:"mt-4","no-padding":""},{legend:s(()=>[c(n(u(p)("student.fee.receipt")),1)]),default:s(()=>[l(R,{corner:"sharp",header:O},{default:s(()=>[(o(!0),i(_,null,F(C.state.transactions,f=>(o(),B(w,null,{default:s(()=>[l(a,{name:"codeNumber"},{default:s(()=>[c(n(f.codeNumber)+" ",1),l(M,{block:""},{default:s(()=>[c(n(f.referenceNumber),1)]),_:2},1024),f.isCancelled.value||f.isRejected.value||f.isFailed?(o(),B(x,{key:0,design:"error"},{default:s(()=>[c(n(u(p)("general.failed")),1)]),_:1})):m("",!0)]),_:2},1024),l(a,{name:"date"},{default:s(()=>[c(n(f.date.formatted),1)]),_:2},1024),l(a,{name:"amount"},{default:s(()=>[c(n(f.amount.formatted),1)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})):m("",!0),l(ne,{"init-url":"guestPayment/",visibility:$.value,uuid:C.state.student.uuid,"pre-requisites":{paymentGateways:C.paymentGateways},"fee-group":b.feeGroup,fee:b.fee,date:C.state.date,onClose:L,onCompleted:q},null,8,["visibility","uuid","pre-requisites","fee-group","fee","date"])],64)}}}),Ve={class:"flex justify-end"},De={class:"flex justify-center"},Be={href:"/",class:"mb-6"},we=["src"],Fe={key:0,class:"mb-6"},Ne=["innerHTML"],xe={key:0,class:"grid grid-cols-2 gap-4"},Ue={class:"col-span-2 sm:col-span-1"},je={class:"mt-4 grid grid-cols-3 gap-4"},Pe={key:0,class:"col-span-3 sm:col-span-1"},Te={key:1,class:"col-span-3 sm:col-span-1"},Oe={key:2,class:"col-span-3 sm:col-span-1"},Ge={class:"mt-4 grid grid-cols-3 gap-4"},Me={class:"col-span-3 sm:col-span-1"},Se={class:"col-span-3 sm:col-span-1"},Ee={key:0,class:"mt-4 grid grid-cols-3 gap-4"},Ie={class:"col-span-3 sm:col-span-1"},Le={class:"mt-4 grid grid-cols-3 gap-4"},qe={class:"col-span-3 sm:col-span-1"},Ae={class:"col-span-3 sm:col-span-1"},Re={class:"mt-4 flex justify-end space-x-4"},He={class:"grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-4"},ze=["is-loading"],We={class:"mt-4 flex justify-end space-x-4"},Je={name:"GuestPayment"},Ye=Object.assign(Je,{setup(C){const E=ae(),N=K(),j={type:"existing",team:"",period:"",course:"",batch:"",codeNumber:"",birthDate:"",name:"",contactNumber:"",heads:[],amount:"",gateway:""},p="guestPayment/",P=z("layout.display").value=="dark"?z("assets.iconLight"):z("assets.icon"),g=ee(p),O=Q(!1),v=S({instruction:"",types:[],teams:[],paymentGateways:[],periods:[],courses:[],feeHeads:[]}),$=S({hasOneTeam:!1,hasProceeded:!1,previousDues:[]}),b=S({student:{},date:{},feeGroups:[],fees:[],transactions:[],summary:{}}),r=S({...j}),H=async()=>{await N.dispatch(p+"preRequisite").then(a=>{v.instruction=a.instruction,v.types=a.types,v.teams=a.teams,a.teams.length==1&&(r.team=a.teams[0].uuid,$.hasOneTeam=!0,G(r.team))}).catch(a=>{E.push({name:"Dashboard"})})},G=async a=>{if(a==null){r.team="";return}r.team=a,await N.dispatch(p+"getPeriods",{team:r.team}).then(t=>{v.periods=t.periods,v.paymentGateways=t.paymentGateways}).catch(t=>{})},I=async a=>{if(a==null){r.period="";return}r.period=a,await N.dispatch(p+"getCourses",{team:r.team,period:r.period}).then(t=>{v.courses=t.courses,v.feeHeads=t.feeHeads,t.feeHeads.forEach(h=>{r.heads.push({uuid:h.uuid,name:h.name,amount:0})})}).catch(t=>{})},L=()=>{},q=()=>{$.hasProceeded=!1,Object.assign(r,se(j)),N.dispatch(p+"resetFormErrors")},V=async()=>{await N.dispatch(p+"getPaymentDetail",{form:{type:r.type,team:r.team,period:r.period,course:r.course,codeNumber:r.codeNumber,birthDate:r.birthDate}}).then(a=>{$.hasProceeded=!0,$.previousDues=a.previousDues,Object.assign(b,a.feeDetails)}).catch(a=>{})},D=async()=>{await V()};return te(()=>{H()}),(a,t)=>{const h=k("BaseAlert"),A=k("CustomCheckbox"),w=k("BaseSelect"),x=k("BaseInput"),R=k("DatePicker"),T=k("BaseButton"),M=k("BaseDataView"),f=k("BaseLoader");return o(),i(_,null,[d("div",Ve,[d("span",{class:"text-sm text-gray-500 cursor-pointer",onClick:t[0]||(t[0]=e=>u(E).push({name:"Dashboard"}))},[t[18]||(t[18]=d("i",{class:"fas fa-home mr-1"},null,-1)),c(" "+n(a.$trans("global.go_to",{attribute:a.$trans("dashboard.home")})),1)])]),d("div",De,[d("a",Be,[d("img",{class:"h-16 w-auto",src:u(P),alt:""},null,8,we)])]),l(f,{"is-loading":O.value},{default:s(()=>[v.instruction?(o(),i("div",Fe,[l(h,{size:"xs",design:"info"},{default:s(()=>[c(n(a.$trans("student.payment.payment_instruction_alert")),1)]),_:1}),d("div",{class:"mt-4 text-sm",innerHTML:v.instruction},null,8,Ne)])):m("",!0),$.hasProceeded?m("",!0):(o(),i(_,{key:1},[v.types.length>1?(o(),i("div",xe,[d("div",Ue,[l(A,{label:a.$trans("general.type"),options:v.types,modelValue:r.type,"onUpdate:modelValue":t[1]||(t[1]=e=>r.type=e),error:u(g).type,"onUpdate:error":t[2]||(t[2]=e=>u(g).type=e)},null,8,["label","options","modelValue","error"])])])):m("",!0),d("div",je,[!r.team||!$.hasOneTeam?(o(),i("div",Pe,[l(w,{modelValue:r.team,"onUpdate:modelValue":t[3]||(t[3]=e=>r.team=e),name:"team",label:a.$trans("team.team"),"label-prop":"name","value-prop":"uuid",options:v.teams,error:u(g).team,"onUpdate:error":t[4]||(t[4]=e=>u(g).team=e),onChange:G},null,8,["modelValue","label","options","error"])])):m("",!0),r.team?(o(),i("div",Te,[l(w,{modelValue:r.period,"onUpdate:modelValue":t[5]||(t[5]=e=>r.period=e),name:"period",label:a.$trans("academic.period.period"),"label-prop":"name","value-prop":"uuid",options:v.periods,error:u(g).period,"onUpdate:error":t[6]||(t[6]=e=>u(g).period=e),onChange:I},null,8,["modelValue","label","options","error"])])):m("",!0),r.period?(o(),i("div",Oe,[l(w,{modelValue:r.course,"onUpdate:modelValue":t[7]||(t[7]=e=>r.course=e),name:"course",label:a.$trans("academic.course.course"),"value-prop":"uuid",options:v.courses,error:u(g).course,"onUpdate:error":t[8]||(t[8]=e=>u(g).course=e)},{selectedOption:s(e=>[c(n(e.value.nameWithTerm),1)]),listOption:s(e=>[c(n(e.option.nameWithTerm),1)]),_:1},8,["modelValue","label","options","error"])])):m("",!0)]),r.type=="new"?(o(),i(_,{key:1},[d("div",Ge,[d("div",Me,[l(x,{type:"text",modelValue:r.name,"onUpdate:modelValue":t[9]||(t[9]=e=>r.name=e),name:"name",label:a.$trans("contact.props.name"),error:u(g).name,"onUpdate:error":t[10]||(t[10]=e=>u(g).name=e)},null,8,["modelValue","label","error"])]),d("div",Se,[l(x,{type:"text",modelValue:r.contactNumber,"onUpdate:modelValue":t[11]||(t[11]=e=>r.contactNumber=e),name:"contactNumber",label:a.$trans("contact.props.contact_number"),error:u(g).contactNumber,"onUpdate:error":t[12]||(t[12]=e=>u(g).contactNumber=e)},null,8,["modelValue","label","error"])])]),r.heads.length?(o(),i("div",Ee,[(o(!0),i(_,null,F(r.heads,(e,U)=>(o(),i("div",Ie,[l(x,{modelValue:e.amount,"onUpdate:modelValue":y=>e.amount=y,name:`heads.${U}.amount`,currency:"",label:e.name,error:u(g)[`heads.${U}.amount`],"onUpdate:error":y=>u(g)[`heads.${U}.amount`]=y,onChange:L},null,8,["modelValue","onUpdate:modelValue","name","label","error","onUpdate:error"])]))),256))])):m("",!0)],64)):m("",!0),r.type=="existing"&&r.course?(o(),i(_,{key:2},[d("div",Le,[d("div",qe,[l(x,{type:"text",modelValue:r.codeNumber,"onUpdate:modelValue":t[13]||(t[13]=e=>r.codeNumber=e),name:"codeNumber",label:a.$trans("student.admission.props.code_number"),error:u(g).codeNumber,"onUpdate:error":t[14]||(t[14]=e=>u(g).codeNumber=e)},null,8,["modelValue","label","error"])]),d("div",Ae,[l(R,{modelValue:r.birthDate,"onUpdate:modelValue":t[15]||(t[15]=e=>r.birthDate=e),name:"birthDate",label:a.$trans("contact.props.birth_date"),"no-clear":"",error:u(g).birthDate,"onUpdate:error":t[16]||(t[16]=e=>u(g).birthDate=e)},null,8,["modelValue","label","error"])])]),d("div",Re,[l(T,{onClick:q,design:"danger"},{default:s(()=>[c(n(a.$trans("general.reset")),1)]),_:1}),l(T,{onClick:V},{default:s(()=>[c(n(a.$trans("general.proceed")),1)]),_:1})])],64)):m("",!0)],64)),$.hasProceeded?(o(),i(_,{key:2},[d("dl",He,[l(M,{label:a.$trans("student.admission.props.code_number")},{default:s(()=>{var e;return[c(n((e=b.student)==null?void 0:e.codeNumber),1)]}),_:1},8,["label"]),l(M,{label:a.$trans("student.props.name")},{default:s(()=>{var e;return[c(n((e=b.student)==null?void 0:e.name),1)]}),_:1},8,["label"]),l(M,{label:a.$trans("academic.course.course")},{default:s(()=>{var e,U;return[c(n(((e=b.student)==null?void 0:e.courseName)+" "+((U=b.student)==null?void 0:U.batchName)),1)]}),_:1},8,["label"])]),$.previousDues.length>0?(o(),i("div",{key:0,class:"mt-4","is-loading":O.value},[(o(!0),i(_,null,F($.previousDues,e=>(o(),i("div",null,[l(h,{size:"xs",design:"error"},{default:s(()=>[c(n(a.$trans("student.fee.previous_due_info",{period:e.period,amount:e.balance.formatted})),1)]),_:2},1024)]))),256))],8,ze)):m("",!0),b.feeGroups.length?(o(),B(Ce,{key:1,state:b,"payment-gateways":v.paymentGateways,onSetIsLoading:t[17]||(t[17]=e=>O.value=e),onRefresh:D},null,8,["state","payment-gateways"])):m("",!0),d("div",We,[l(T,{onClick:q,design:"danger"},{default:s(()=>[c(n(a.$trans("general.cancel")),1)]),_:1})])],64)):m("",!0)]),_:1},8,["is-loading"])],64)}}});export{Ye as default};
