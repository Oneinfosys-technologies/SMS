import{i as G,f as j,h as J,E as U,G as K,l as Q,m as y,r as m,o as l,q as D,w as i,d as _,u as r,C as h,s as p,t as n,a as f,F as B,e as c,b,x as W,I as R}from"./app-DCfJDSeM.js";const X={class:"grid grid-cols-3 gap-6"},Y={class:"col-span-3 sm:col-span-1"},Z={key:0},x={key:2,class:"mt-2 text-sm"},ee={key:0},te={key:0,class:"col-span-3 sm:col-span-1"},ae={class:"col-span-3"},se={key:0,class:"mt-4 grid grid-cols-1"},ne={class:"col"},re={name:"StudentTransferForm"},oe=Object.assign(re,{setup(O){const g=G(),d=j();J();const S={student:"",requestDate:null,reason:"",application:[],mediaUpdated:!1,mediaToken:U(),mediaHash:[]},q="student/transferRequest/",u=K(q),v=Q(!1),N=y({students:[]}),s=y({selectedStudent:null,feeSummary:{}}),o=y({...S}),$=y({student:"",isLoaded:!d.params.uuid}),H=a=>{Object.assign(N,a),Object.assign(o,R(S))},A=()=>{o.mediaToken=U(),o.mediaHash=[]},M=a=>{let t=a.student;s.selectedStudent={uuid:t.uuid,name:t.name,courseName:t.courseName,batchName:t.batchName,codeNumber:t.codeNumber,joiningDate:t.joiningDate},Object.assign(S,{...a,student:t.uuid,requestDate:a.requestDate.value,application:a.media}),Object.assign(o,R(S)),$.isLoaded=!0},C=async a=>{v.value=!0,await g.dispatch("student/getFeeSummary",{uuid:a}).then(t=>{v.value=!1,s.feeSummary=t}).catch(t=>{v.value=!1})},F=a=>{o.student=a?a.uuid:"",a&&C(a.uuid)},V=()=>{s.selectedStudent=null,o.student="",s.feeSummary={}};return(a,t)=>{const w=m("BaseSelect"),k=m("TextMuted"),E=m("BaseSelectSearch"),L=m("DatePicker"),I=m("BaseTextarea"),P=m("MediaUpload"),z=m("FormAction");return l(),D(z,{"pre-requisites":!0,onSetPreRequisites:H,"init-url":q,"init-form":S,form:o,"set-form":M,redirect:"StudentTransferRequest",onResetMediaFiles:A},{default:i(()=>{var T;return[_("div",X,[_("div",Y,[r(h)(["student","guardian"],"any")?(l(),D(w,{key:0,name:"student",label:a.$trans("global.select",{attribute:a.$trans("student.student")}),modelValue:s.selectedStudent,"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedStudent=e),error:r(u).student,"onUpdate:error":t[1]||(t[1]=e=>r(u).student=e),options:N.students,"value-prop":"uuid","object-prop":!0,onSelected:F,onRemoved:V},{selectedOption:i(e=>[p(n(e.value.name)+" ("+n(e.value.courseName+" "+e.value.batchName)+") ",1)]),listOption:i(e=>[p(n(e.option.name)+" ("+n(e.option.courseName+" "+e.option.batchName)+") ",1)]),_:1},8,["label","modelValue","error","options"])):(l(),f(B,{key:1},[r(d).params.uuid&&s.selectedStudent?(l(),f("div",Z,[p(n(s.selectedStudent.name)+" ",1),c(k,{block:""},{default:i(()=>[p(n(s.selectedStudent.codeNumber),1)]),_:1}),c(k,{block:""},{default:i(()=>[p(n(a.$trans("student.admission.props.date"))+": "+n(s.selectedStudent.joiningDate.formatted),1)]),_:1})])):b("",!0),r(d).params.uuid?b("",!0):(l(),D(E,{key:1,name:"student",label:a.$trans("global.select",{attribute:a.$trans("student.student")}),modelValue:s.selectedStudent,"onUpdate:modelValue":t[2]||(t[2]=e=>s.selectedStudent=e),error:r(u).student,"onUpdate:error":t[3]||(t[3]=e=>r(u).student=e),"value-prop":"uuid","object-prop":!0,"init-search":$.student,"search-key":"name","search-action":"student/summary",onSelected:F,onRemoved:V},{selectedOption:i(e=>[p(n(e.value.name)+" ("+n(e.value.courseName+" "+e.value.batchName)+") ",1)]),listOption:i(e=>[p(n(e.option.name)+" ("+n(e.option.courseName+" "+e.option.batchName)+") ",1)]),_:1},8,["label","modelValue","error","init-search"]))],64)),!r(d).params.uuid&&s.selectedStudent?(l(),f("div",x,[c(k,{block:""},{default:i(()=>[p(n(s.selectedStudent.codeNumber),1)]),_:1}),_("div",null,n(a.$trans("student.admission.props.date"))+": "+n(s.selectedStudent.joiningDate.formatted),1),s.selectedStudent.leavingDate.value?(l(),f("div",ee,n(a.$trans("student.transfer.props.date"))+": "+n(s.selectedStudent.leavingDate.formatted),1)):b("",!0),s.feeSummary.balanceFee?(l(),f("div",{key:1,class:W(["font-semibold",{"text-red-500":s.feeSummary.balanceFee.value>0,"text-green-500":s.feeSummary.balanceFee.value<0}])},n(a.$trans("finance.fee.balance")+": "+s.feeSummary.balanceFee.formatted),3)):b("",!0)])):b("",!0)]),r(h)(["student","guardian"],"any")?b("",!0):(l(),f("div",te,[c(L,{modelValue:o.requestDate,"onUpdate:modelValue":t[4]||(t[4]=e=>o.requestDate=e),name:"requestDate",label:a.$trans("student.transfer_request.props.request_date"),"no-clear":"",error:r(u).requestDate,"onUpdate:error":t[5]||(t[5]=e=>r(u).requestDate=e)},null,8,["modelValue","label","error"])])),_("div",ae,[c(I,{rows:1,modelValue:o.reason,"onUpdate:modelValue":t[6]||(t[6]=e=>o.reason=e),name:"reason",label:a.$trans("student.transfer_request.props.reason"),error:r(u).reason,"onUpdate:error":t[7]||(t[7]=e=>r(u).reason=e)},null,8,["modelValue","label","error"])])]),s.selectedStudent&&(((T=s.feeSummary.balanceFee)==null?void 0:T.value)==0||r(d).params.uuid)?(l(),f("div",se,[_("div",ne,[c(P,{multiple:"",label:a.$trans("general.file"),module:"transfer_request",section:"application",media:o.application,"media-token":o.mediaToken,onIsUpdated:t[8]||(t[8]=e=>o.mediaUpdated=!0),onSetHash:t[9]||(t[9]=e=>o.mediaHash.push(e)),error:r(u).application,"onUpdate:error":t[10]||(t[10]=e=>r(u).application=e)},null,8,["label","media","media-token","error"])])])):b("",!0)]}),_:1},8,["form"])}}}),ue={name:"StudentTransferRequestAction"},le=Object.assign(ue,{setup(O){const g=j();return(d,S)=>{const q=m("PageHeaderAction"),u=m("PageHeader"),v=m("ParentTransition");return l(),f(B,null,[c(u,{title:d.$trans(r(g).meta.trans,{attribute:d.$trans(r(g).meta.label)}),navs:[{label:d.$trans("student.student"),path:"Student"},{label:d.$trans("student.transfer_request.transfer_request"),path:"StudentTransferRequest"}]},{default:i(()=>[c(q,{name:"StudentTransferRequest",title:d.$trans("student.transfer_request.transfer_request"),actions:["list"]},null,8,["title"])]),_:1},8,["title","navs"]),c(v,{appear:"",visibility:!0},{default:i(()=>[c(oe)]),_:1})],64)}}});export{le as default};
