import{i as X,G as Y,c as ee,l as J,m as P,r as d,z as Z,o as n,q as C,w as t,a as p,t as m,e as l,d as r,u as e,F as q,v as H,A as D,x as te,b as V,I as ae,j as K,s as k,L as ne,y as Q,f as se,h as le}from"./app-DCfJDSeM.js";const oe={key:0},re={key:1},ie={class:"grid grid-cols-4 gap-2"},ue={class:"col-span-4 sm:col-span-2 lg:col-span-1"},ce={class:"col-span-4 sm:col-span-2 lg:col-span-1"},de={class:"col-span-4 sm:col-span-2 lg:col-span-1"},pe={class:"space-x-2"},me=["onClick"],fe={key:0},_e={key:1},be=["onClick"],ye={key:0},ge={key:1},ve={key:2},Fe={key:0,class:"mt-4 grid grid-cols-4 gap-2"},ke={class:"col-span-4 sm:col-span-2 lg:col-span-1"},he={key:0,class:"col-span-4 sm:col-span-2 lg:col-span-1"},$e={class:"mt-4 grid grid-cols-4 gap-2"},Ve={class:"col-span-4 sm:col-span-2 lg:col-span-1"},Se={class:"col-span-4 sm:col-span-2 lg:col-span-1"},Te={class:"col-span-4 sm:col-span-2 lg:col-span-1"},Be={name:"FeeInstallmentForm"},Ue=Object.assign(Be,{props:{visibility:{type:Boolean,default:!1},feeStructure:{type:Object,default(){return{}}},feeGroup:{type:Object,default(){return{}}},feeInstallment:{type:Object,default(){return{}}},isEditable:{type:Boolean,default:!1}},emits:["close","completed","refresh"],setup(T,{emit:M}){const E=X(),b=M,i=T,v={feeGroup:"",title:"",dueDate:null,hasLateFee:!1,hasTransportFee:!1,lateFeeFrequency:"daily",lateFeeValue:0,lateFeeType:"amount",heads:[],transportFee:""},F="finance/feeStructure/",y=Y(F),h=ee(()=>{var a;return!!(!(((a=i.feeInstallment)==null?void 0:a.uuid)||"")||i.isEditable)});J(!1),P({paidFeeInstallmentCount:0});const o=P({transportFees:[],feeGroups:[],frequencies:[]}),_=P({...v}),R=u=>{var a,I,S;if(Object.assign(o,u),v.feeGroup=i.feeGroup.uuid,i.feeInstallment.uuid){let f=[];i.feeInstallment.heads.forEach(B=>{f.push({name:B.name,uuid:B.uuid,amount:B.amount.value,isOptional:!!B.isOptional,applicableTo:B.applicableTo})}),Object.assign(v,{...i.feeInstallment,heads:f,dueDate:i.feeInstallment.dueDate.value,transportFee:((a=i.feeInstallment.transportFee)==null?void 0:a.uuid)||"",lateFeeFrequency:((I=i.feeInstallment.lateFeeFrequency)==null?void 0:I.value)||"",lateFeeValue:((S=i.feeInstallment.lateFeeValue)==null?void 0:S.value)||"",lateFeeType:i.feeInstallment.lateFeeType})}else v.heads=[],i.feeGroup.heads.forEach(f=>{v.heads.push({...f,amount:0,isOptional:!1,applicableTo:"all"})});Object.assign(_,ae(v))},$=u=>{u.applicableTo==="new"?u.applicableTo="old":u.applicableTo==="old"?u.applicableTo="all":u.applicableTo="new"},c=()=>{E.dispatch(F+"resetFormErrors"),b("close")},N=()=>{b("refresh")};return(u,a)=>{const I=d("BaseInput"),S=d("DatePicker"),f=d("BaseCheckbox"),B=d("BaseSelect"),O=d("FormAction"),z=d("BaseModal"),j=Z("tooltip");return n(),C(z,{show:T.visibility,onClose:c,onRefresh:N},{title:t(()=>[T.feeInstallment.uuid?(n(),p("span",oe,m(u.$trans("global.edit",{attribute:u.$trans("finance.fee_structure.installment")})),1)):(n(),p("span",re,m(u.$trans("global.add",{attribute:u.$trans("finance.fee_structure.installment")})),1))]),default:t(()=>[l(O,{"no-card":"","no-data-fetch":"","is-modal":"",uuid:T.feeStructure.uuid,moduleUuid:T.feeInstallment.uuid,"pre-requisites":!0,onSetPreRequisites:R,action:T.feeInstallment.uuid?"updateInstallment":"addInstallment","init-url":F,"init-form":v,form:_,"keep-adding":!1,onRedirectTo:a[12]||(a[12]=s=>b("completed"))},{default:t(()=>[r("div",ie,[r("div",ue,[l(I,{type:"text",name:"title",modelValue:_.title,"onUpdate:modelValue":a[0]||(a[0]=s=>_.title=s),label:u.$trans("finance.fee_structure.props.title"),error:e(y).title,"onUpdate:error":a[1]||(a[1]=s=>e(y).title=s)},null,8,["modelValue","label","error"])]),r("div",ce,[l(S,{modelValue:_.dueDate,"onUpdate:modelValue":a[2]||(a[2]=s=>_.dueDate=s),name:"dueDate",label:u.$trans("finance.fee_structure.props.due_date"),"no-clear":"",error:e(y).dueDate,"onUpdate:error":a[3]||(a[3]=s=>e(y).dueDate=s)},null,8,["modelValue","label","error"])]),h.value?(n(!0),p(q,{key:0},H(_.heads,(s,G)=>(n(),p("div",de,[l(I,{name:`heads.${G}.amount`,modelValue:s.amount,"onUpdate:modelValue":g=>s.amount=g,label:s.name,currency:"",error:e(y)[`heads.${G}.amount`],"onUpdate:error":g=>e(y)[`heads.${G}.amount`]=g},{"additional-label":t(()=>[r("div",pe,[r("span",{class:"cursor-pointer",onClick:g=>s.isOptional=!s.isOptional},[s.isOptional?D((n(),p("span",_e,a[14]||(a[14]=[r("i",{class:"fas fa-question-circle text-gray-900 dark:text-gray-300"},null,-1)]))),[[j,u.$trans("finance.fee_structure.props.is_optional")]]):D((n(),p("span",fe,a[13]||(a[13]=[r("i",{class:"fas fa-check-circle text-gray-900 dark:text-gray-300"},null,-1)]))),[[j,u.$trans("finance.fee_structure.props.is_mandatory")]])],8,me),r("span",{class:te({"cursor-pointer":_.isEditable}),onClick:g=>$(s)},[s.applicableTo==="new"?D((n(),p("span",ye,a[15]||(a[15]=[r("i",{class:"fas fa-user-plus text-gray-900 dark:text-gray-300"},null,-1)]))),[[j,u.$trans("finance.fee_structure.props.new_student")]]):s.applicableTo==="old"?D((n(),p("span",ge,a[16]||(a[16]=[r("i",{class:"fas fa-user-lock text-gray-900 dark:text-gray-300"},null,-1)]))),[[j,u.$trans("finance.fee_structure.props.old_student")]]):s.applicableTo==="all"?D((n(),p("span",ve,a[17]||(a[17]=[r("i",{class:"fas fa-user-graduate text-gray-900 dark:text-gray-300"},null,-1)]))),[[j,u.$trans("finance.fee_structure.props.all_student")]]):V("",!0)],10,be)])]),_:2},1032,["name","modelValue","onUpdate:modelValue","label","error","onUpdate:error"])]))),256)):V("",!0)]),h.value?(n(),p("div",Fe,[r("div",ke,[l(f,{modelValue:_.hasTransportFee,"onUpdate:modelValue":a[4]||(a[4]=s=>_.hasTransportFee=s),name:"hasTransportFee",label:u.$trans("finance.fee_structure.props.has_transport_fee")},null,8,["modelValue","label"])]),_.hasTransportFee?(n(),p("div",he,[l(B,{modelValue:_.transportFee,"onUpdate:modelValue":a[5]||(a[5]=s=>_.transportFee=s),name:"transportFee",label:u.$trans("transport.fee.fee"),options:o.transportFees,"label-prop":"name","value-prop":"uuid",error:e(y).transportFee,"onUpdate:error":a[6]||(a[6]=s=>e(y).transportFee=s)},null,8,["modelValue","label","options","error"])])):V("",!0)])):V("",!0),r("div",$e,[r("div",Ve,[l(f,{modelValue:_.hasLateFee,"onUpdate:modelValue":a[7]||(a[7]=s=>_.hasLateFee=s),name:"hasLateFee",label:u.$trans("finance.fee_structure.props.has_late_fee")},null,8,["modelValue","label"])]),_.hasLateFee?(n(),p(q,{key:0},[r("div",Se,[l(B,{modelValue:_.lateFeeFrequency,"onUpdate:modelValue":a[8]||(a[8]=s=>_.lateFeeFrequency=s),name:"lateFeeFrequency",label:u.$trans("finance.fee_structure.props.late_fee_frequency"),options:o.frequencies,"label-prop":"label","value-prop":"value",error:e(y).lateFeeFrequency,"onUpdate:error":a[9]||(a[9]=s=>e(y).lateFeeFrequency=s)},null,8,["modelValue","label","options","error"])]),r("div",Te,[l(I,{modelValue:_.lateFeeValue,"onUpdate:modelValue":a[10]||(a[10]=s=>_.lateFeeValue=s),name:"lateFeeValue",label:u.$trans("finance.fee_structure.props.late_fee_value"),currency:"",error:e(y).lateFeeValue,"onUpdate:error":a[11]||(a[11]=s=>e(y).lateFeeValue=s)},null,8,["modelValue","label","error"])])],64)):V("",!0)])]),_:1},8,["uuid","moduleUuid","action","form"])]),_:1},8,["show"])}}}),we={class:"flex justify-between"},Ce={class:"text-right sm:text-left"},De={key:0,class:"flex justify-between mr-4"},Ie={class:"space-x-2"},Oe={key:0},je={key:1},qe={key:2},Me={key:3},Re={key:4},Ae={class:"ml-3"},Ee={name:"FinanceFeeStructureShowGroup"},Le=Object.assign(Ee,{props:{feeStructure:{type:Object,default(){return{}}}},emits:["refresh"],setup(T,{emit:M}){const E=X(),b=K("$trans"),i=K("emitter"),v=T,F=M,y=J(!1),h=J(!1),o=P({}),_=P({}),R="finance/feeStructure/",$=[{key:"title",label:b("finance.fee_structure.props.title"),visibility:!0},{key:"dueDate",label:b("finance.fee_structure.props.due_date"),visibility:!0},{key:"fee",label:b("finance.fee.fee"),visibility:!0},{key:"total",label:b("general.total"),visibility:!0,align:"right"},{key:"action",label:"",visibility:!0}],c=()=>{Object.assign(o,{}),h.value=!1},N=()=>{F("refresh"),c()},u=S=>{Object.assign(o,S),h.value=!0},a=(S,f)=>{Object.assign(o,S),Object.assign(_,f),h.value=!0},I=async S=>{await ne()&&(y.value=!0,await E.dispatch(R+"deleteInstallment",{moduleUuid:S,uuid:v.feeStructure.uuid}).then(()=>{y.value=!1,F("refresh")}).catch(f=>{y.value=!1}))};return(S,f)=>{const B=d("BaseButton"),O=d("DataCell"),z=d("DataRow"),j=d("TextMuted"),s=d("FloatingMenuItem"),G=d("FloatingMenu"),g=d("SimpleTable"),L=d("BaseLoader"),A=Z("tooltip");return n(),p(q,null,[l(L,{"is-loading":y.value},{default:t(()=>[l(g,{corner:"sharp",header:$},{default:t(()=>[(n(!0),p(q,null,H(T.feeStructure.feeGroups,x=>(n(),p(q,null,[l(z,{"is-heading":""},{default:t(()=>[l(O,{colspan:100,"is-heading":""},{default:t(()=>[r("div",we,[r("span",null,m(x.name),1),D((n(),C(B,{size:"xs",design:"primary",onClick:U=>u(x)},{default:t(()=>f[1]||(f[1]=[r("i",{class:"fas fa-plus"},null,-1)])),_:2},1032,["onClick"])),[[A,e(b)("global.add",{attribute:e(b)("finance.fee_structure.installment")})]])])]),_:2},1024)]),_:2},1024),(n(!0),p(q,null,H(x.installments,U=>(n(),C(z,{key:U.uuid},{default:t(()=>[l(O,{name:"title"},{default:t(()=>{var w;return[k(m(U.title)+" ",1),(w=U.transportFee)!=null&&w.uuid?(n(),C(j,{key:0,block:""},{default:t(()=>{var W;return[k(m((W=U.transportFee)==null?void 0:W.name),1)]}),_:2},1024)):V("",!0)]}),_:2},1024),l(O,{name:"dueDate"},{default:t(()=>[r("div",Ce,[r("p",null,m(U.dueDate.formatted),1),U.hasLateFee?(n(),C(j,{key:0,block:""},{default:t(()=>[k(m(e(b)("finance.fee_structure.props.late_fee"))+" "+m(U.lateFeeDisplay),1)]),_:2},1024)):V("",!0)])]),_:2},1024),l(O,{name:"fee",table:""},{default:t(()=>[(n(!0),p(q,null,H(U.heads,w=>{var W;return n(),p(q,null,[((W=w.amount)==null?void 0:W.value)>0?(n(),p("div",De,[r("div",Ie,[w.isOptional?D((n(),p("span",Oe,f[2]||(f[2]=[r("i",{class:"fas fa-question-circle"},null,-1)]))),[[A,e(b)("finance.fee_structure.props.is_optional")]]):D((n(),p("span",je,f[3]||(f[3]=[r("i",{class:"fas fa-check-circle"},null,-1)]))),[[A,e(b)("finance.fee_structure.props.is_mandatory")]]),w.applicableTo==="new"?D((n(),p("span",qe,f[4]||(f[4]=[r("i",{class:"fas fa-user-plus"},null,-1)]))),[[A,e(b)("finance.fee_structure.props.new_student")]]):w.applicableTo==="old"?D((n(),p("span",Me,f[5]||(f[5]=[r("i",{class:"fas fa-user-lock"},null,-1)]))),[[A,e(b)("finance.fee_structure.props.old_student")]]):w.applicableTo==="all"?D((n(),p("span",Re,f[6]||(f[6]=[r("i",{class:"fas fa-user-graduate"},null,-1)]))),[[A,e(b)("finance.fee_structure.props.all_student")]]):V("",!0),r("span",Ae,m(w.name),1)]),r("div",null,m(w.amount.formatted),1)])):V("",!0)],64)}),256))]),_:2},1024),l(O,{align:"right",name:"total"},{default:t(()=>[k(m(U.total.formatted),1)]),_:2},1024),l(O,{name:"action"},{default:t(()=>[l(G,null,{default:t(()=>[l(s,{icon:"fas fa-edit",onClick:w=>a(x,U)},{default:t(()=>[k(m(e(b)("general.edit")),1)]),_:2},1032,["onClick"]),l(s,{icon:"fas fa-trash",onClick:w=>I(U.uuid)},{default:t(()=>[k(m(e(b)("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))],64))),256))]),_:1})]),_:1},8,["is-loading"]),l(Ue,{visibility:h.value,"fee-structure":T.feeStructure,"fee-group":o,"fee-installment":_,"is-editable":T.feeStructure.isEditable,onClose:c,onCompleted:N,onRefresh:f[0]||(f[0]=x=>e(i).emit("refresh"))},null,8,["visibility","fee-structure","fee-group","fee-installment","is-editable"])],64)}}}),xe={class:"grid grid-cols-1 gap-4"},Ge={class:"col-span-1"},Pe={key:0,class:"col-span-1"},ze={key:1,class:"col-span-1"},Ne={name:"FeeAllocationForm"},We=Object.assign(Ne,{props:{uuid:{type:String,default:""}},emits:["completed"],setup(T,{emit:M}){const E=M,b={type:"",courses:[],batches:[]},i="finance/feeStructure/",v=Y(i),F=P({...b}),y=()=>{E("completed")};return(h,o)=>{const _=d("BaseRadioGroup"),R=d("BaseSelectSearch"),$=d("FormAction");return n(),C($,{"init-url":i,uuid:T.uuid,"no-data-fetch":"",action:"allocation","init-form":b,form:F,"keep-adding":!1,"after-submit":y},{default:t(()=>[r("div",xe,[r("div",Ge,[l(_,{options:[{label:h.$trans("academic.course.course"),value:"course"},{label:h.$trans("academic.batch.batch"),value:"batch"}],name:"type",modelValue:F.type,"onUpdate:modelValue":o[0]||(o[0]=c=>F.type=c),error:e(v).type,"onUpdate:error":o[1]||(o[1]=c=>e(v).type=c),horizontal:""},null,8,["options","modelValue","error"])]),F.type=="course"?(n(),p("div",Pe,[l(R,{name:"courses",multiple:"",label:h.$trans("academic.course.course"),modelValue:F.courses,"onUpdate:modelValue":o[2]||(o[2]=c=>F.courses=c),error:e(v).courses,"onUpdate:error":o[3]||(o[3]=c=>e(v).courses=c),"value-prop":"uuid","search-action":"academic/course/list"},{selectedOption:t(c=>[k(m(c.value.division.name)+" - "+m(c.value.nameWithTerm),1)]),listOption:t(c=>[k(m(c.option.division.name)+" - "+m(c.option.nameWithTerm),1)]),_:1},8,["label","modelValue","error"])])):V("",!0),F.type=="batch"?(n(),p("div",ze,[l(R,{name:"batches",multiple:"",label:h.$trans("academic.batch.batch"),modelValue:F.batches,"onUpdate:modelValue":o[4]||(o[4]=c=>F.batches=c),error:e(v).batches,"onUpdate:error":o[5]||(o[5]=c=>e(v).batches=c),"search-key":"course_batch","value-prop":"uuid","search-action":"academic/batch/list"},{selectedOption:t(c=>[k(m(c.value.course.name)+" - "+m(c.value.name),1)]),listOption:t(c=>[k(m(c.option.course.nameWithTerm)+" - "+m(c.option.name),1)]),_:1},8,["label","modelValue","error"])])):V("",!0)])]),_:1},8,["uuid","form"])}}}),He={class:"mt-4 grid grid-cols-1 gap-x-4 gap-y-8 px-4 sm:grid-cols-2 sm:px-6"},Je=["innerHTML"],Ke={key:0},Qe={key:1},Xe={name:"FinanceFeeStructureShow"},Ze=Object.assign(Xe,{setup(T){X();const M=se(),E=le(),b=K("emitter"),i=K("$trans"),v={},F="finance/feeStructure/",y=[{key:"course",label:i("academic.course.course"),visibility:!0},{key:"batch",label:i("academic.batch.batch"),visibility:!0},{key:"action",label:"",visibility:!0}],h=J(!1),o=P({...v}),_=R=>{Object.assign(o,R)};return(R,$)=>{const c=d("PageHeaderAction"),N=d("PageHeader"),u=d("BaseDataView"),a=d("BaseButton"),I=d("ShowButton"),S=d("BaseCard"),f=d("DataCell"),B=d("FloatingMenuItem"),O=d("FloatingMenu"),z=d("DataRow"),j=d("SimpleTable"),s=d("ShowItem"),G=d("ParentTransition");return n(),p(q,null,[l(N,{title:e(i)(e(M).meta.trans,{attribute:e(i)(e(M).meta.label)}),navs:[{label:e(i)("finance.finance"),path:"Finance"},{label:e(i)("finance.fee_structure.fee_structure"),path:"FinanceFeeStructureList"}]},{default:t(()=>[l(c,{name:"FinanceFeeStructure",title:e(i)("finance.fee_structure.fee_structure"),actions:["list"]},null,8,["title"])]),_:1},8,["title","navs"]),l(G,{appear:"",visibility:!0},{default:t(()=>[l(s,{"init-url":F,uuid:e(M).params.uuid,refresh:h.value,onRefreshed:$[3]||($[3]=g=>h.value=!1),onSetItem:_,onRedirectTo:$[4]||($[4]=g=>e(E).push({name:"FinanceFeeStructure"}))},{default:t(()=>[o.uuid?(n(),C(S,{key:0,"no-padding":"","no-content-padding":""},{title:t(()=>[k(m(o.name),1)]),footer:t(()=>[l(I,null,{default:t(()=>[e(Q)("fee-structure:edit")&&o.isEditable?(n(),C(a,{key:0,design:"primary",onClick:$[1]||($[1]=g=>e(E).push({name:"FinanceFeeStructureEdit",params:{uuid:o.uuid}}))},{default:t(()=>[k(m(e(i)("general.edit")),1)]),_:1})):V("",!0)]),_:1})]),default:t(()=>[l(Le,{"fee-structure":o,onRefresh:$[0]||($[0]=g=>h.value=!0)},null,8,["fee-structure"]),r("dl",He,[l(u,{class:"col-span-1 sm:col-span-2",label:e(i)("finance.fee_structure.props.description")},{default:t(()=>[r("div",{innerHTML:o.description},null,8,Je)]),_:1},8,["label"]),l(u,{label:e(i)("general.created_at")},{default:t(()=>[k(m(o.createdAt.formatted),1)]),_:1},8,["label"]),l(u,{label:e(i)("general.updated_at")},{default:t(()=>[k(m(o.updatedAt.formatted),1)]),_:1},8,["label"])])]),_:1})):V("",!0),o.uuid&&o.allocations.length?(n(),C(S,{key:1,class:"mt-4","no-padding":"","no-content-padding":""},{title:t(()=>[k(m(e(i)("finance.fee_structure.allocation")),1)]),default:t(()=>[l(j,{header:y},{default:t(()=>[(n(!0),p(q,null,H(o.allocations,g=>(n(),C(z,{key:g.uuid},{default:t(()=>[l(f,{name:"course"},{default:t(()=>{var L;return[k(m(((L=g.course)==null?void 0:L.name)||"-"),1)]}),_:2},1024),l(f,{name:"batch"},{default:t(()=>{var L,A,x;return[g.batch?(n(),p("span",Ke,m(((A=(L=g.batch)==null?void 0:L.course)==null?void 0:A.name)+" "+((x=g.batch)==null?void 0:x.name)),1)):(n(),p("span",Qe," - "))]}),_:2},1024),l(f,{name:"action"},{default:t(()=>[l(O,null,{default:t(()=>[e(Q)("fee-structure:allocate")?(n(),C(B,{key:0,icon:"fas fa-trash",onClick:L=>e(b).emit("showActionItem",{confirmation:!0,action:"removeAllocation",uuid:o.uuid,moduleUuid:g.uuid})},{default:t(()=>[k(m(e(i)("general.delete")),1)]),_:2},1032,["onClick"])):V("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):V("",!0),e(Q)("fee-structure:allocate")&&o.uuid?(n(),C(S,{key:2,class:"mt-4","no-padding":"","no-content-padding":""},{title:t(()=>[k(m(e(i)("finance.fee_structure.allocate")),1)]),default:t(()=>[l(We,{onCompleted:$[2]||($[2]=g=>e(b).emit("refreshItem"))})]),_:1})):V("",!0)]),_:1},8,["uuid","refresh"])]),_:1})],64)}}});export{Ze as default};
