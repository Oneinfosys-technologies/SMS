import{E as D,G as E,m as N,o as n,q as g,w as o,d as t,t as u,e as _,b as y,f as w,r as l,l as M,c as O,n as z,p as H,a as B,F,j as I,v as L,x as R,u as q,y as G,s as h,h as J,i as K,aJ as P}from"./app-DCfJDSeM.js";const Q={class:"grid grid-cols-1"},W={class:"col"},X={name:"ActivityTripMediaForm"},Y=Object.assign(X,{props:{trip:{type:Object,default(){return{}}},visibility:{type:Boolean,default:!1}},emits:["close","completed"],setup(i,{emit:$}){w();const r=$,m={media:[],mediaUpdated:!1,mediaToken:D(),mediaHash:[]},p="activity/trip/media/";E(p);const a=N({...m});return(f,e)=>{const v=l("MediaUpload"),b=l("FormAction"),C=l("BaseSideover");return n(),g(C,{visibility:i.visibility,onClose:e[6]||(e[6]=s=>r("close"))},{title:o(()=>[t("span",null,u(f.$trans("global.add",{attribute:f.$trans("activity.trip.media.media")})),1)]),default:o(()=>[_(b,{sideover:"","no-card":"","no-data-fetch":"","cancel-action":"",action:"create","init-url":p,"init-form":m,form:a,onEnd:e[3]||(e[3]=s=>r("close")),onCompleted:e[4]||(e[4]=s=>r("completed")),onCancelled:e[5]||(e[5]=s=>r("close"))},{default:o(()=>[t("div",Q,[t("div",W,[i.trip.uuid?(n(),g(v,{key:0,multiple:"",label:f.$trans("general.file"),module:"trip",media:a.media,onIsUpdated:e[0]||(e[0]=s=>a.mediaUpdated=!0),onSetHash:e[1]||(e[1]=s=>a.mediaHash=s),onSetToken:e[2]||(e[2]=s=>a.mediaToken=s)},null,8,["label","media"])):y("",!0)])])]),_:1},8,["form"])]),_:1},8,["visibility"])}}}),Z={class:"grid grid-cols-1"},ee={class:"grid grid-cols-4 gap-6"},te=["onClick"],se={class:"flex items-start justify-between"},ie={class:"flex cursor-pointer"},ae={class:"mr-4"},ne={class:"flex flex-col"},oe={name:"ActivityTripMediaList"},re=Object.assign(oe,{props:{trip:{type:Object,default(){return{}}}},emits:["refresh"],setup(i,{emit:$}){w(),J();const r=K(),m=I("emitter"),p=$,a=i,f="activity/trip/media/",e=M(!1),v=M(!1),b=()=>{v.value=!1},C=O(()=>r.getters["config/config"]("system.url")),s=c=>{window.open(C.value+`/app/activity/trips/${a.trip.uuid}/media/`+c)},U=async c=>{await P()&&(e.value=!0,await r.dispatch(f+"delete",{uuid:a.trip.uuid,moduleUuid:c.uuid}).then(()=>{e.value=!1,p("refresh")}).catch(k=>{e.value=!1}))};return z(async()=>{m.on("addActivityTripMedia",()=>{v.value=!0})}),H(()=>{m.all.delete("addActivityTripMedia")}),(c,k)=>{const x=l("FloatingMenuItem"),A=l("FloatingMenu"),T=l("BaseAlert"),j=l("BaseDataView"),S=l("BaseCard");return n(),B(F,null,[i.trip.uuid?(n(),g(S,{key:0,"is-loading":e.value},{default:o(()=>[t("div",Z,[_(j,{class:"col-span-1"},{default:o(()=>[t("div",ee,[(n(!0),B(F,null,L(i.trip.media,d=>(n(),B("div",{onClick:V=>s(d.uuid),class:"col-span-4 sm:col-span-1"},[t("div",se,[t("div",ie,[t("span",ae,[t("i",{class:R(["fas text-4xl",d.icon])},null,2)]),t("div",ne,[t("span",null,u(d.name),1),t("span",null,u(d.size),1),t("span",null,u(d.uuid),1)])]),t("div",null,[q(G)("trip:manage")?(n(),g(A,{key:0},{default:o(()=>[_(x,{icon:"fas fa-trash",onClick:V=>U(d)},{default:o(()=>[h(u(c.$trans("general.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)):y("",!0)])])],8,te))),256))]),i.trip.media.length===0?(n(),g(T,{key:0,design:"info",size:"xs"},{default:o(()=>[h(u(c.$trans("general.errors.attachment_not_found")),1)]),_:1})):y("",!0)]),_:1})])]),_:1},8,["is-loading"])):y("",!0),_(Y,{trip:i.trip,visibility:v.value,onCompleted:k[0]||(k[0]=d=>p("refresh")),onClose:b},null,8,["trip","visibility"])],64)}}});export{re as default};
