import{f as P,m as V,G as x,n as z,r as c,o as m,q as h,w as t,d as g,u as f,s as i,t as r,b as C,e as o,l as Z,J as ee,a as U,F as I,v as E,h as te,i as ae,j as oe,L as ne,I as se}from"./app-DCfJDSeM.js";import{i as le,t as re,a as ie}from"./table-FwhM-Z75.js";const ce={class:"grid grid-cols-3 gap-6"},de={class:"col-span-3 sm:col-span-1"},ue={class:"col-span-3 sm:col-span-1"},me={__name:"Filter",props:{initUrl:{type:String,default:""}},emits:["hide"],setup(L,{emit:k}){const $=P(),T=k,y=L,d={name:"",batch:""},p=V({...d}),b=x(y.initUrl),_=V({batch:"",isLoaded:!$.query.batch});return z(async()=>{_.batch=$.query.batch,_.isLoaded=!0}),(s,n)=>{const w=c("BaseSelectSearch"),F=c("BaseInput"),N=c("FilterForm");return m(),h(N,{"init-form":d,form:p,onHide:n[3]||(n[3]=u=>T("hide"))},{default:t(()=>[g("div",ce,[g("div",de,[_.isLoaded?(m(),h(w,{key:0,name:"batch",label:s.$trans("global.select",{attribute:s.$trans("academic.batch.batch")}),modelValue:p.batch,"onUpdate:modelValue":n[0]||(n[0]=u=>p.batch=u),error:f(b).batch,"onUpdate:error":n[1]||(n[1]=u=>f(b).batch=u),"value-prop":"uuid","init-search":_.batch,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:t(u=>[i(r(u.value.course.name)+" "+r(u.value.name),1)]),listOption:t(u=>[i(r(u.option.course.nameWithTerm)+" "+r(u.option.name),1)]),_:1},8,["label","modelValue","error","init-search"])):C("",!0)]),g("div",ue,[o(F,{type:"text",modelValue:p.name,"onUpdate:modelValue":n[2]||(n[2]=u=>p.name=u),name:"name",label:s.$trans("student.props.name")},null,8,["modelValue","label"])])])]),_:1},8,["form"])}}},pe={class:"p-2"},fe={key:0,class:"fas fa-check-circle text-success"},be={class:"grid grid-cols-3 gap-6 px-4 py-2"},_e={class:"col-span-3 sm:col-span-1"},ge={class:"col-span-3 sm:col-span-1"},ye={key:0,class:"col-span-3 sm:col-span-2"},ve={class:"col-span-3 space-y-2"},Ce={class:"flex flex-wrap gap-y-2"},he={class:"grid grid-cols-3 gap-6 px-4 py-2"},ke={class:"col-span-3 sm:col-span-1"},Be={name:"StudentFeeAllocation"},Te=Object.assign(Be,{setup(L){const k=P();te();const $=ae();oe("emitter");const T={batch:"",name:"",selectAll:!1,students:[],feeConcession:"",feeConcessionType:"",transportCircle:"",direction:"",optedFeeHeads:[]},y="student/feeAllocation/",d=Z(!1),p=V({feeConcessions:[],feeConcessionTypes:[],transportCircles:[],directions:[],feeHeads:[]}),b=x(y),_=V({data:[]}),s=V({...T});V({});const n=V({...le}),w=async()=>{d.value=!0,await $.dispatch(y+"preRequisite").then(l=>{d.value=!1,Object.assign(p,l)}).catch(l=>{d.value=!1})},F=async()=>{d.value=!0,await $.dispatch(y+"fetch",{params:k.query}).then(l=>{d.value=!1,s.batch=k.query.batch,s.name=k.query.name,Object.assign(_,l),n.pageItems=l.data.map(a=>a.uuid)}).catch(l=>{d.value=!1})},N=()=>{Object.assign(s,se(T))},u=()=>{n.global=!n.global,s.selectAll=n.global},M=async()=>{await ne()&&(d.value=!0,await $.dispatch(y+"remove",{form:s}).then(l=>{d.value=!1,q()}).catch(l=>{d.value=!1}))},q=async()=>{n.items=[],n.pageItems=[],n.all=!1,s.selectAll=!1,N(),await F()};return ee(()=>[n.items,n.pageItems],([l,a],[j,A])=>{s.students=l,n.all=ie(n)}),z(async()=>{await w(),k.query.batch&&await F()}),(l,a)=>{const j=c("PageHeader"),A=c("ParentTransition"),J=c("BaseAlert"),D=c("BaseCard"),H=c("BaseArrayCheckbox"),W=c("BaseCheckbox"),B=c("DataCell"),S=c("TextMuted"),K=c("DataRow"),Q=c("DataTable"),X=c("BaseButton"),R=c("BaseSelect"),O=c("BaseLabel"),Y=c("BaseRadioGroup"),G=c("FormAction");return m(),U(I,null,[o(j,{title:l.$trans(f(k).meta.label),navs:[{label:l.$trans("student.student"),path:"Student"}]},null,8,["title","navs"]),o(A,{appear:"",visibility:!0},{default:t(()=>[o(me,{onAfterFilter:F,"init-url":y})]),_:1}),_.data.length==0?(m(),h(D,{key:0,"no-padding":"","no-content-padding":"","is-loading":d.value},{title:t(()=>[i(r(l.$trans("student.fee_allocation.fee_allocation")),1)]),default:t(()=>[g("div",pe,[o(J,{size:"xs",design:"error"},{default:t(()=>[i(r(l.$trans("general.errors.record_not_found")),1)]),_:1})])]),_:1},8,["is-loading"])):C("",!0),_.data.length>0?(m(),h(A,{key:1,appear:"",visibility:!0},{default:t(()=>[o(Q,{onToggleSelectAll:a[2]||(a[2]=e=>n.items=f(re)(e,n)),onToggleGlobalSelect:u,selected:n,header:_.headers,meta:_.meta,module:"student.fee_allocation",onRefresh:F},{actionButton:t(()=>a[12]||(a[12]=[])),default:t(()=>[(m(!0),U(I,null,E(_.data,e=>(m(),h(K,{key:e.uuid},{default:t(()=>[o(B,{name:"selectAll"},{default:t(()=>[n.global?C("",!0):(m(),h(H,{key:0,items:n.items,"onUpdate:items":a[0]||(a[0]=v=>n.items=v),value:e.uuid},null,8,["items","value"])),n.global?(m(),h(W,{key:1,modelValue:n.global,"onUpdate:modelValue":a[1]||(a[1]=v=>n.global=v)},null,8,["modelValue"])):C("",!0)]),_:2},1024),o(B,{name:"codeNumber"},{default:t(()=>[i(r(e.codeNumber)+" ",1),e.feesCount?(m(),U("i",fe)):C("",!0),o(S,{block:""},{default:t(()=>[i(r(e.joiningDate.formatted),1)]),_:2},1024)]),_:2},1024),o(B,{name:"name"},{default:t(()=>[i(r(e.name)+" ",1),o(S,{block:""},{default:t(()=>[i(r(e.gender.label),1)]),_:2},1024)]),_:2},1024),o(B,{name:"course"},{default:t(()=>[i(r(e.courseName)+" ",1),o(S,{block:""},{default:t(()=>[i(r(e.batchName),1)]),_:2},1024)]),_:2},1024),o(B,{name:"installmentCount"},{default:t(()=>[i(r(e.feesCount==0?"-":e.feesCount)+" ",1),o(S,{block:""},{default:t(()=>{var v;return[i(r(((v=e.feeConcessionType)==null?void 0:v.name)||""),1)]}),_:2},1024)]),_:2},1024),o(B,{name:"contactNumber"},{default:t(()=>[i(r(e.contactNumber)+" ",1),o(S,{block:""},{default:t(()=>[i(r(e.email),1)]),_:2},1024)]),_:2},1024),o(B,{name:"parent"},{default:t(()=>[i(r(e.fatherName)+" ",1),o(S,{block:""},{default:t(()=>[i(r(e.motherName),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["selected","header","meta"])]),_:1})):C("",!0),n.items.length>0?(m(),h(A,{key:2,appear:"",visibility:!0},{default:t(()=>[o(D,{"is-loading":d.value},{title:t(()=>[i(r(l.$trans("student.fee_allocation.fee_allocation")),1)]),action:t(()=>[o(X,{onClick:M,size:"xs",design:"error"},{default:t(()=>[i(r(l.$trans("global.remove",{attribute:l.$trans("student.fee.fee")})),1)]),_:1})]),default:t(()=>[o(G,{"no-card":"","keep-adding":!1,"init-url":y,action:"allocate","init-form":T,form:s,"after-submit":q},{default:t(()=>[g("div",be,[g("div",_e,[o(R,{modelValue:s.feeConcession,"onUpdate:modelValue":a[3]||(a[3]=e=>s.feeConcession=e),name:"feeConcession",label:l.$trans("finance.fee_concession.fee_concession"),options:p.feeConcessions,"label-prop":"name","value-prop":"uuid",error:f(b).feeConcession,"onUpdate:error":a[4]||(a[4]=e=>f(b).feeConcession=e)},null,8,["modelValue","label","options","error"])]),g("div",ge,[o(R,{modelValue:s.transportCircle,"onUpdate:modelValue":a[5]||(a[5]=e=>s.transportCircle=e),name:"transportCircle",label:l.$trans("transport.circle.circle"),options:p.transportCircles,"label-prop":"name","value-prop":"uuid",error:f(b).transportCircle,"onUpdate:error":a[6]||(a[6]=e=>f(b).transportCircle=e)},null,8,["modelValue","label","options","error"])]),s.transportCircle?(m(),U("div",ye,[o(O,null,{default:t(()=>[i(r(l.$trans("transport.circle.direction")),1)]),_:1}),o(Y,{"top-margin":"",options:p.directions,name:"direction",modelValue:s.direction,"onUpdate:modelValue":a[7]||(a[7]=e=>s.direction=e),error:f(b).direction,"onUpdate:error":a[8]||(a[8]=e=>f(b).direction=e),horizontal:""},null,8,["options","modelValue","error"])])):C("",!0),g("div",ve,[o(O,null,{default:t(()=>[i(r(l.$trans("student.fee.opted_fee")),1)]),_:1}),g("div",Ce,[(m(!0),U(I,null,E(p.feeHeads,e=>(m(),U("div",{class:"w-1/3",key:e.uuid},[o(H,{items:s.optedFeeHeads,"onUpdate:items":a[9]||(a[9]=v=>s.optedFeeHeads=v),value:e.uuid,label:e.name},null,8,["items","value","label"])]))),128))])])])]),_:1},8,["form"])]),_:1},8,["is-loading"]),o(D,{class:"mt-4","is-loading":d.value},{title:t(()=>[i(r(l.$trans("finance.fee_concession.type.type")),1)]),action:t(()=>a[13]||(a[13]=[])),default:t(()=>[o(G,{"no-card":"","keep-adding":!1,"init-url":y,action:"allocateFeeConcessionType","init-form":T,form:s,"after-submit":q},{default:t(()=>[g("div",he,[g("div",ke,[o(R,{modelValue:s.feeConcessionType,"onUpdate:modelValue":a[10]||(a[10]=e=>s.feeConcessionType=e),name:"feeConcessionType",label:l.$trans("finance.fee_concession.type.type"),options:p.feeConcessionTypes,"label-prop":"name","value-prop":"uuid",error:f(b).feeConcessionType,"onUpdate:error":a[11]||(a[11]=e=>f(b).feeConcessionType=e)},null,8,["modelValue","label","options","error"])])])]),_:1},8,["form"])]),_:1},8,["is-loading"])]),_:1})):C("",!0)],64)}}});export{Te as default};
