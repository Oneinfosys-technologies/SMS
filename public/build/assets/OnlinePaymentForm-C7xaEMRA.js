import{n as N,r as k,o as l,a as v,d as $,e as p,w as r,s as u,t as d,U as T,b as i,f as D,i as A,G as K,l as J,m as M,K as Q,q as y,F as j,u as h,y as W,L as X}from"./app-DCfJDSeM.js";import{_ as Y,a as Z,b as x,c as ee,d as ae}from"./Billdesk-rvYHEUh7.js";const te=["action"],ne=["value"],le=["value"],oe={name:"PaymentGatewayPayzone"},re=Object.assign(oe,{props:{payment:{type:Object,required:!0}},setup(t){const G=()=>{document.getElementById("payzoneForm").submit()};return N(()=>{setTimeout(G,3e3)}),(B,z)=>{const U=k("TextMuted");return t.payment?(l(),v("form",{key:0,id:"payzoneForm",class:"mt-4",method:"post",action:t.payment.pgUrl,onSubmit:T(G,["prevent"])},[$("input",{type:"hidden",name:"payload",value:t.payment.payload},null,8,ne),$("input",{type:"hidden",name:"signature",value:t.payment.signature},null,8,le),p(U,{block:""},{default:r(()=>[u(d(B.$trans("general.redirecting_to_payment_gateway")),1)]),_:1})],40,te)):i("",!0)}}}),ie={class:"grid grid-cols-1 sm:grid-cols-3 gap-x-4 gap-y-8 mb-4"},se={class:"grid grid-cols-3 gap-4"},ue={class:"col-span-3 sm:col-span-1"},de={key:0,class:"col-span-3"},me={class:"mt-4"},ye={name:"StudentFeeOnlinePaymentForm"},ce=Object.assign(ye,{props:{visibility:{type:Boolean,default:!1},initUrl:{type:String,default:"student/payment/"},uuid:{type:String,default:""},date:{type:Object,default(){return{}}},fee:{type:Object,default(){return{}}},feeGroup:{type:Object,default(){return{}}},feeHead:{type:Object,default(){return{}}},preRequisites:{type:Object,default(){return{}}}},emits:["close","completed"],setup(t,{emit:G}){const B=D(),z=A(),U=G,o=t,s={uuid:o.uuid||B.params.uuid,feeHead:null,feeGroup:null,feeInstallment:null,date:"",amount:"",gateway:""},_=K(o.initUrl),C=J(!1),n=M({initiated:!1,payment:null}),e=M({...s}),S=()=>{V(),z.dispatch(o.initUrl+"resetFormErrors"),U("close")},R=()=>{n.initiated=!1,U("completed")},O=a=>{C.value=a},g=a=>!!o.preRequisites.paymentGateways.find(m=>m.value==a),V=()=>{n.initiated=!1,n.payment=null,e.gateway="",s.feeGroup=null,s.feeHead=null,s.feeInstallment=null,s.date="",Object.assign(e,s)},b=async()=>{console.log("test"),await X()&&(C.value=!0,await z.dispatch(o.initUrl+"initiatePayment",e).then(a=>{if(a.hasOwnProperty("payment")&&a.payment.amount<=0){location.reload();return}n.initiated=!0,n.payment=a,C.value=!1}).catch(a=>{C.value=!1}))};return Q(()=>{var a,m,f;o.feeGroup.uuid?(s.feeGroup=o.feeGroup.uuid,s.amount=o.feeGroup.balance.value):o.feeHead.uuid?(s.feeHead=o.feeHead.uuid,s.amount=o.feeHead.balance.value):o.fee.uuid&&(s.feeInstallment=o.fee.uuid,s.amount=o.fee.balance.value),((m=(a=o.preRequisites)==null?void 0:a.paymentGateways)==null?void 0:m.length)==1&&(s.gateway=o.preRequisites.paymentGateways[0].value),s.date=(f=o.date)==null?void 0:f.value,Object.assign(e,s)}),(a,m)=>{const f=k("BaseDataView"),E=k("BaseInput"),I=k("BaseRadioGroup"),w=k("BaseButton"),P=k("BaseModal");return l(),y(P,{show:t.visibility,onClose:S},{title:r(()=>[u(d(a.$trans("global.pay",{attribute:a.$trans("student.fee.fee")})),1)]),default:r(()=>{var F,H,q,L;return[$("dl",ie,[p(f,{label:a.$trans("general.date")},{default:r(()=>[u(d(t.date.formatted),1)]),_:1},8,["label"]),t.feeGroup.uuid?(l(),v(j,{key:0},[p(f,{label:a.$trans("finance.fee_group.fee_group")},{default:r(()=>[u(d(t.feeGroup.name),1)]),_:1},8,["label"]),p(f,{label:a.$trans("finance.fee.balance")},{default:r(()=>[u(d(t.feeGroup.balance.formatted),1)]),_:1},8,["label"])],64)):t.feeHead.uuid?(l(),v(j,{key:1},[p(f,{label:a.$trans("finance.fee_head.fee_head")},{default:r(()=>[u(d(t.feeHead.name),1)]),_:1},8,["label"]),p(f,{label:a.$trans("finance.fee.balance")},{default:r(()=>[u(d(t.feeHead.balance.formatted),1)]),_:1},8,["label"])],64)):t.fee.uuid?(l(),v(j,{key:2},[p(f,{label:a.$trans("finance.fee_structure.installment")},{default:r(()=>[u(d(t.fee.installment.title),1)]),_:1},8,["label"]),p(f,{label:a.$trans("finance.fee.balance")},{default:r(()=>[u(d(t.fee.balance.formatted),1)]),_:1},8,["label"])],64)):i("",!0)]),$("div",se,[$("div",ue,[p(E,{disabled:!h(W)("fee:partial-payment"),modelValue:e.amount,"onUpdate:modelValue":m[0]||(m[0]=c=>e.amount=c),name:"amount",label:a.$trans("student.fee.props.amount"),currency:"",error:h(_).amount,"onUpdate:error":m[1]||(m[1]=c=>h(_).amount=c)},null,8,["disabled","modelValue","label","error"])]),t.preRequisites.paymentGateways.length>1?(l(),v("div",de,[p(I,{disabled:n.initiated,options:t.preRequisites.paymentGateways,name:"gateway",modelValue:e.gateway,"onUpdate:modelValue":m[2]||(m[2]=c=>e.gateway=c),error:h(_).gateway,"onUpdate:error":m[3]||(m[3]=c=>h(_).gateway=c),horizontal:""},null,8,["disabled","options","modelValue","error"])])):i("",!0)]),g("razorpay")&&e.gateway=="razorpay"?(l(),y(Y,{key:0,"init-url":t.initUrl,form:e,payment:n.payment,onLoading:O,onRefresh:R},null,8,["init-url","form","payment"])):i("",!0),g("stripe")&&e.gateway=="stripe"?(l(),y(Z,{key:1,"init-url":t.initUrl,form:e,payment:n.payment,onCancel:V,onLoading:O,onRefresh:R},null,8,["init-url","form","payment"])):i("",!0),g("payzone")&&e.gateway=="payzone"&&((F=n==null?void 0:n.payment)!=null&&F.token)?(l(),y(re,{key:2,"init-url":t.initUrl,form:e,payment:n.payment,onCancel:V,onLoading:O,onRefresh:R},null,8,["init-url","form","payment"])):i("",!0),g("paypal")&&e.gateway=="paypal"&&((H=n.payment)!=null&&H.token)?(l(),y(x,{key:3,"init-url":t.initUrl,form:e,payment:n.payment,onCancel:V,onLoading:O,onRefresh:R},null,8,["init-url","form","payment"])):i("",!0),g("ccavenue")&&e.gateway=="ccavenue"&&((q=n.payment)!=null&&q.token)?(l(),y(ee,{key:4,payment:n.payment},null,8,["payment"])):i("",!0),g("billdesk")&&e.gateway=="billdesk"&&((L=n.payment)!=null&&L.token)?(l(),y(ae,{key:5,payment:n.payment},null,8,["payment"])):i("",!0),$("div",me,[e.gateway?(l(),v(j,{key:0},[e.gateway!="stripe"&&e.gateway!="payzone"&&e.gateway!="paypal"&&e.gateway!="ccavenue"&&e.gateway!="billdesk"?(l(),y(w,{key:0,design:"primary",onClick:b},{default:r(()=>[u(d(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="stripe"&&!n.payment?(l(),y(w,{key:1,design:"primary",onClick:b},{default:r(()=>[u(d(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="payzone"&&!n.payment?(l(),y(w,{key:2,design:"primary",onClick:b},{default:r(()=>[u(d(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="paypal"&&!n.payment?(l(),y(w,{key:3,design:"primary",onClick:b},{default:r(()=>[u(d(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="ccavenue"&&!n.payment?(l(),y(w,{key:4,design:"primary",onClick:b},{default:r(()=>[u(d(a.$trans("general.proceed")),1)]),_:1})):i("",!0),e.gateway=="billdesk"&&!n.payment?(l(),y(w,{key:5,design:"primary",onClick:b},{default:r(()=>[u(d(a.$trans("general.proceed")),1)]),_:1})):i("",!0)],64)):i("",!0)])]}),_:1},8,["show"])}}});export{ce as _};
