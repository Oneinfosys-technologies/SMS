import{f as A,j as P,m as $,G as U,n as C,r as n,o as u,q as v,w as e,d as T,s as p,t as c,b as M,y as x,l as D,a as S,e as a,u as F,F as w,v as k,i as E}from"./app-DCfJDSeM.js";const G={class:"grid grid-cols-3 gap-6"},W={class:"col-span-3 sm:col-span-1"},z={__name:"Filter",props:{initUrl:{type:String,default:""}},emits:["hide"],setup(B,{emit:f}){const _=A();P("moment");const y=f,b=B,h={batches:[]},r=$({...h});U(b.initUrl);const s=$({isLoaded:!_.query.batches});return C(async()=>{s.batches=_.query.batches?_.query.batches.split(","):[],s.isLoaded=!0}),(l,i)=>{const o=n("BaseSelectSearch"),m=n("FilterForm");return u(),v(m,{"init-form":h,multiple:["batches"],form:r,onHide:i[1]||(i[1]=t=>y("hide"))},{default:e(()=>[T("div",G,[T("div",W,[s.isLoaded?(u(),v(o,{key:0,multiple:"",name:"batches",label:l.$trans("global.select",{attribute:l.$trans("academic.batch.batch")}),modelValue:r.batches,"onUpdate:modelValue":i[0]||(i[0]=t=>r.batches=t),"value-prop":"uuid","init-search":s.batches,"search-key":"course_batch","search-action":"academic/batch/list"},{selectedOption:e(t=>[p(c(t.value.course.name)+" "+c(t.value.name),1)]),listOption:e(t=>[p(c(t.option.course.nameWithTerm)+" "+c(t.option.name),1)]),_:1},8,["label","modelValue","init-search"])):M("",!0)])])]),_:1},8,["form"])}}},I={name:"StudentReportAttendanceSummary"},K=Object.assign(I,{setup(B){const f=A(),_=E();let y=["filter"],b=[];x("student:list-attendance")&&(b=["print","pdf","excel"]);const h="student/report/",r=D(!1),s=D(!1),l=$({headers:[],data:[],meta:{total:0}}),i=async()=>{s.value=!0,await _.dispatch(h+"fetchReport",{name:"attendance-summary",params:f.query}).then(o=>{s.value=!1,Object.assign(l,o)}).catch(o=>{s.value=!1})};return C(async()=>{await i()}),(o,m)=>{const t=n("PageHeaderAction"),V=n("PageHeader"),R=n("ParentTransition"),H=n("TextMuted"),g=n("DataCell"),q=n("DataRow"),L=n("DataTable"),j=n("BaseCard");return u(),S(w,null,[a(V,{title:o.$trans(F(f).meta.label),navs:[{label:o.$trans("student.student"),path:"Student"},{label:o.$trans("student.report.report"),path:"StudentReport"}]},{default:e(()=>[a(t,{url:"student/reports/attendance-summary/",name:"StudentReportAttendanceSummary",title:o.$trans("student.report.attendance_summary.attendance_summary"),actions:F(y),"dropdown-actions":F(b),headers:l.headers,onToggleFilter:m[0]||(m[0]=d=>r.value=!r.value)},null,8,["title","actions","dropdown-actions","headers"])]),_:1},8,["title","navs"]),a(R,{appear:"",visibility:r.value},{default:e(()=>[a(z,{onAfterFilter:i,"init-url":h,onHide:m[1]||(m[1]=d=>r.value=!1)})]),_:1},8,["visibility"]),a(R,{appear:"",visibility:!0},{default:e(()=>[a(j,{"no-padding":"","no-content-padding":"","is-loading":s.value},{default:e(()=>[a(L,{header:l.headers,meta:l.meta,module:"student.report.attendance_summary",onRefresh:i},{default:e(()=>[(u(!0),S(w,null,k(l.data,d=>(u(),v(q,{key:d.uuid},{default:e(()=>[a(g,{name:"course_batch"},{default:e(()=>[p(c(d.courseBatch)+" ",1),a(H,{block:""},{default:e(()=>[p(c(d.incharge),1)]),_:2},1024)]),_:2},1024),(u(!0),S(w,null,k(d.attendances,(N,O)=>(u(),v(g,{name:O},{default:e(()=>[p(c(N),1)]),_:2},1032,["name"]))),256)),a(g,{name:"total"},{default:e(()=>[p(c(d.total),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["header","meta"])]),_:1},8,["is-loading"])]),_:1})],64)}}});export{K as default};
