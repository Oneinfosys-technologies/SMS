import{c as U,aL as W,f as K,j as Y,m as R,G as Z,n as x,r as g,o as d,q as B,w as r,d as n,u as i,s as $,t as o,b as w,e as s,h as se,i as ue,l as X,a as H,F as C,v as P,E as ie,I as me}from"./app-DCfJDSeM.js";function ee(p=""){var E;let l=U(()=>W.getters["config/config"]("system.currencies"));p||(p=(E=W.getters["config/config"]("system.currency"))==null?void 0:E.name);let u=l.value.find(k=>k.name==p);return u===void 0?{decimal:2,position:"prefix"}:u}function F(p=0,l=""){let u=ee(l);return de(p,u.decimal||2)}function I(p=0,l=""){let u=ee(l);return p=F(p,l),u.position==="prefix"?u.symbol+""+p:p+" "+u.symbol}function de(p,l){l=Math.abs(parseInt(l))||0;var u=Math.pow(10,l);return Math.round(p*u)/u}const pe={class:"grid grid-cols-3 gap-6"},ce={class:"col-span-3 sm:col-span-1"},ye={class:"col-span-3 sm:col-span-1"},fe={__name:"FilterGenerate",props:{initUrl:{type:String,default:""}},emits:["hide"],setup(p,{emit:l}){const u=K();Y("moment");const E=l,k=p,D={employee:"",startDate:"",endDate:""},b=R({...D}),c=Z(k.initUrl),L=R({employee:"",isLoaded:!u.query.employee});return x(async()=>{L.employee=u.query.employee,L.isLoaded=!0}),(j,y)=>{const M=g("BaseSelectSearch"),G=g("DatePicker"),z=g("FilterForm");return d(),B(z,{"init-form":D,form:b,onHide:y[5]||(y[5]=m=>E("hide"))},{default:r(()=>[n("div",pe,[n("div",ce,[L.isLoaded?(d(),B(M,{key:0,name:"employee",label:j.$trans("global.select",{attribute:j.$trans("employee.employee")}),modelValue:b.employee,"onUpdate:modelValue":y[0]||(y[0]=m=>b.employee=m),"value-prop":"uuid","init-search":L.employee,"additional-search-query":{self:0},"search-action":"employee/list",error:i(c).employee,"onUpdate:error":y[1]||(y[1]=m=>i(c).employee=m)},{selectedOption:r(m=>[$(o(m.value.name)+" ("+o(m.value.codeNumber)+") ",1)]),listOption:r(m=>[$(o(m.option.name)+" ("+o(m.option.codeNumber)+") ",1)]),_:1},8,["label","modelValue","init-search","error"])):w("",!0)]),n("div",ye,[s(G,{start:b.startDate,"onUpdate:start":y[2]||(y[2]=m=>b.startDate=m),end:b.endDate,"onUpdate:end":y[3]||(y[3]=m=>b.endDate=m),name:"dateBetween",as:"range",label:j.$trans("employee.payroll.props.period"),error:i(c).startDate,"onUpdate:error":y[4]||(y[4]=m=>i(c).startDate=m)},null,8,["start","end","label","error"])])])]),_:1},8,["form"])}}},_e={class:"font-semibold"},ge={class:"space-y-4"},be={class:"grid grid-cols-2 gap-4"},ve={class:"col-span-2 space-y-4 sm:col-span-1"},he={class:"col-span-2 space-y-4 sm:col-span-1"},$e={class:"col-span-2 sm:col-span-1"},He={class:"text-success flex justify-between text-lg font-semibold"},Ve={class:"col-span-2 sm:col-span-1"},De={class:"text-danger flex justify-between text-lg font-semibold"},Ue={class:"col-span-2 sm:col-span-1"},Ee={class:"text-success flex justify-between text-xl font-semibold"},ke={class:"mt-4 grid grid-cols-2 gap-4"},Se={class:"col-span-2 space-y-4 sm:col-span-1"},Ce={class:"text-success flex justify-between text-lg font-semibold"},Fe={class:"mt-4 grid grid-cols-2 gap-3"},Be={class:"col-span-3"},Le={name:"EmployeePayrollForm"},je=Object.assign(Le,{setup(p){const l=K(),u=se(),E=ue(),k=Y("emitter"),D={records:[],remarks:""},b="employee/payroll/",c=Z(b),L=U(()=>v.records.filter(e=>e.payHead.category==="earning")),j=U(()=>v.records.filter(e=>e.payHead.category==="deduction")),y=U(()=>v.records.filter(e=>e.payHead.category==="employee_contribution"));U(()=>v.records.filter(e=>e.payHead.category==="employer_contribution"));const M=U(()=>{let e=0;return v.records.filter(a=>a.payHead.category=="earning").forEach(a=>{e+=F(a.amount)}),I(e)}),G=U(()=>{let e=0;return v.records.filter(a=>a.payHead.category=="deduction").forEach(a=>{e+=F(a.amount)}),v.records.filter(a=>a.payHead.category=="employee_contribution").forEach(a=>{e+=F(a.amount)}),I(e)}),z=U(()=>{let e=0;return v.records.forEach(a=>{a.payHead.category=="earning"?e+=F(a.amount):(a.payHead.category=="deduction"||a.payHead.category=="employee_contribution")&&(e-=F(a.amount))}),I(e)}),m=U(()=>{let e=0;return v.records.filter(a=>a.payHead.category=="employer_contribution").forEach(a=>{e+=F(a.amount)}),I(e)}),q=X(!1),S=X(!1),V=R({}),v=R({...D}),Q=async()=>{S.value=!1,q.value=!0,await E.dispatch(b+"fetchDetail",{params:l.query}).then(e=>{Object.assign(V,{attendanceSummary:e.attendanceSummary,netEarning:e.netEarning.value,netDeduction:e.netDeduction.value,netEmployeeContribution:e.employeeContribution.value,netEmployerContribution:e.employerContribution.value,netSalary:e.netSalary.value}),Object.assign(v,{records:e.records}),q.value=!1,S.value=!0}).catch(e=>{q.value=!1})},te=e=>{var O;Object.assign(V,{codeNumber:e.codeNumber,employee:e.employee,period:e.period,attendanceSummary:e.attendanceSummary,netEarning:e.netEarning.value,netDeduction:e.netDeduction.value,netSalary:e.netSalary.value});let a=e.records.map(h=>{let N={uuid:h.payHead.uuid||ie(),name:h.payHead.name,category:h.payHead.category.value,code:h.payHead.code};return{uuid:h.uuid,payHead:N,amount:h.amount.value}});Object.assign(D,{records:a,remarks:e.remarks}),Object.assign(v,me(D)),u.push({name:l.name,query:{employee:(O=e.employee)==null?void 0:O.uuid,startDate:e.startDate.value,endDate:e.endDate.value}})},ae=()=>{S.value=!1},oe=()=>{S.value=!1,k.emit("resetFilter")};return x(async()=>{if(l.params.uuid){S.value=!0;return}l.query.employee&&l.query.startDate&&l.query.endDate&&await Q()}),(e,a)=>{const O=g("ParentTransition"),h=g("ListItemView"),N=g("ListContainerVertical"),J=g("BaseCard"),A=g("BaseLabel"),T=g("BaseInput"),ne=g("BaseTextarea"),re=g("FormAction"),le=g("DetailLayoutVertical");return d(),H(C,null,[s(O,{appear:"",visibility:!0},{default:r(()=>[i(l).params.uuid?w("",!0):(d(),B(fe,{key:0,onAfterFilter:Q,"init-url":b}))]),_:1}),S.value?(d(),B(le,{key:0},{detail:r(()=>[i(l).params.uuid&&V.codeNumber?(d(),B(J,{key:0,"no-padding":"","no-content-padding":""},{title:r(()=>[$(o(e.$trans("employee.payroll.props.code_number"))+" "+o(V.codeNumber),1)]),default:r(()=>[s(N,null,{default:r(()=>[s(h,{label:e.$trans("employee.employee")},{default:r(()=>[$(o(V.employee.name),1)]),_:1},8,["label"]),s(h,{label:e.$trans("employee.department.department")},{default:r(()=>[$(o(V.employee.department),1)]),_:1},8,["label"]),s(h,{label:e.$trans("employee.designation.designation")},{default:r(()=>[$(o(V.employee.designation),1)]),_:1},8,["label"]),s(h,{label:e.$trans("employee.employment_status.employment_status")},{default:r(()=>[$(o(V.employee.employmentStatus),1)]),_:1},8,["label"]),s(h,{label:e.$trans("employee.payroll.props.period")},{default:r(()=>[n("span",_e,o(V.period),1)]),_:1},8,["label"])]),_:1})]),_:1})):w("",!0),s(J,{"no-padding":"","no-content-padding":""},{title:r(()=>[$(o(e.$trans("global.summary",{attribute:e.$trans("attendance.attendance")})),1)]),default:r(()=>[s(N,null,{default:r(()=>[(d(!0),H(C,null,P(V.attendanceSummary,t=>(d(),B(h,{align:"right",label:t.name+" ("+t.code+")"},{default:r(()=>[$(o(t.count)+" "+o(e.$trans("list.durations."+t.unit)),1)]),_:2},1032,["label"]))),256))]),_:1})]),_:1})]),default:r(()=>[n("div",ge,[S.value?(d(),B(J,{key:0,"is-loading":q.value},{default:r(()=>[s(re,{"no-card":"","init-url":b,action:i(l).params.uuid?"edit":"generate","init-form":D,form:v,"set-form":te,"after-reset":ae,redirect:"EmployeePayroll",onCompleted:oe},{default:r(()=>[n("div",be,[n("div",ve,[(d(!0),H(C,null,P(L.value,(t,f)=>(d(),H("div",null,[s(A,{class:"text-success"},{default:r(()=>[$(o(t.payHead.name)+" ("+o(t.payHead.code)+")",1)]),_:2},1024),s(T,{currency:"",modelValue:t.amount,"onUpdate:modelValue":_=>t.amount=_,name:`records.${f}.amount`,placeholder:t.payHead.name,error:i(c)[`records.${f}.amount`],"onUpdate:error":_=>i(c)[`records.${f}.amount`]=_},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))),256))]),n("div",he,[(d(!0),H(C,null,P(j.value,(t,f)=>(d(),H("div",null,[s(A,{class:"text-danger"},{default:r(()=>[$(o(t.payHead.name)+" ("+o(t.payHead.code)+")",1)]),_:2},1024),s(T,{currency:"",modelValue:t.amount,"onUpdate:modelValue":_=>t.amount=_,name:`records.${f}.amount`,placeholder:t.payHead.name,error:i(c)[`records.${f}.amount`],"onUpdate:error":_=>i(c)[`records.${f}.amount`]=_},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))),256)),(d(!0),H(C,null,P(y.value,(t,f)=>(d(),H("div",null,[s(A,{class:"text-danger"},{default:r(()=>[$(o(t.payHead.name)+" ("+o(t.payHead.code)+")",1)]),_:2},1024),s(T,{currency:"",modelValue:t.amount,"onUpdate:modelValue":_=>t.amount=_,name:`records.${f}.amount`,placeholder:t.payHead.name,error:i(c)[`records.${f}.amount`],"onUpdate:error":_=>i(c)[`records.${f}.amount`]=_},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))),256))]),n("div",$e,[n("div",He,[n("span",null,o(e.$trans("employee.payroll.salary_structure.props.net_earning")),1),n("span",null,o(M.value),1)])]),n("div",Ve,[n("div",De,[n("span",null,o(e.$trans("employee.payroll.salary_structure.props.net_deduction")),1),n("span",null,o(G.value),1)])]),n("div",Ue,[n("div",Ee,[n("span",null,o(e.$trans("employee.payroll.salary_structure.props.net_salary")),1),n("span",null,o(z.value),1)])])]),a[2]||(a[2]=n("hr",{class:"my-4"},null,-1)),n("div",ke,[n("div",Se,[(d(!0),H(C,null,P(y.value,(t,f)=>(d(),H("div",null,[s(A,{class:"text-success"},{default:r(()=>[$(o(t.payHead.name)+" ("+o(t.payHead.code)+")",1)]),_:2},1024),s(T,{currency:"",modelValue:t.amount,"onUpdate:modelValue":_=>t.amount=_,name:`records.${f}.amount`,placeholder:t.payHead.name,error:i(c)[`records.${f}.amount`],"onUpdate:error":_=>i(c)[`records.${f}.amount`]=_},null,8,["modelValue","onUpdate:modelValue","name","placeholder","error","onUpdate:error"])]))),256)),n("div",Ce,[n("span",null,o(e.$trans("employee.payroll.salary_structure.props.net_employer_contribution")),1),n("span",null,o(m.value),1)])])]),n("div",Fe,[n("div",Be,[s(ne,{modelValue:v.remarks,"onUpdate:modelValue":a[0]||(a[0]=t=>v.remarks=t),name:"remarks",label:e.$trans("employee.payroll.props.remarks"),error:i(c).remarks,"onUpdate:error":a[1]||(a[1]=t=>i(c).remarks=t)},null,8,["modelValue","label","error"])])])]),_:1},8,["action","form"])]),_:1},8,["is-loading"])):w("",!0)])]),_:1})):w("",!0)],64)}}}),Pe={name:"EmployeePayrollAction"},qe=Object.assign(Pe,{setup(p){const l=K();return(u,E)=>{const k=g("PageHeaderAction"),D=g("PageHeader"),b=g("ParentTransition");return d(),H(C,null,[s(D,{title:u.$trans(i(l).meta.trans,{attribute:u.$trans(i(l).meta.label)}),navs:[{label:u.$trans("employee.employee"),path:"Employee"},{label:u.$trans("employee.payroll.payroll"),path:"EmployeePayroll"}]},{default:r(()=>[s(k,{name:"EmployeePayroll",title:u.$trans("employee.payroll.payroll"),actions:["list"]},null,8,["title"])]),_:1},8,["title","navs"]),s(b,{appear:"",visibility:!0},{default:r(()=>[s(je)]),_:1})],64)}}});export{qe as default};
